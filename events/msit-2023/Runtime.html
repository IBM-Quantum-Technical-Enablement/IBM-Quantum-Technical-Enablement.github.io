

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Qiskit Runtime &#8212; Enabing Technologies  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/thebelab-helper.js"></script>
    <script src="../../_static/design-tabs.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-16824831-8"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'UA-16824831-8');
            </script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'events/msit-2023/Runtime';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />

  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>

<link
  rel="alternate"
  type="application/atom+xml"
  href="../../explore/atom.xml"
  title="Quantum Explorations"
/>



  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the site..."
         aria-label="Search the site..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../_static/dark_logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
    
  </div>
  
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../how-to/howto.html">
                        How to guides
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../explore.html">
                        Explorations
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../hardware/hardware.html">
                        IBM Hardware
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../events.html">
                        Events
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../members.html">
                        Contributors
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the site..."
         aria-label="Search the site..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/IBM-Quantum-Technical-Enablement" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../how-to/howto.html">
                        How to guides
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../explore.html">
                        Explorations
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../hardware/hardware.html">
                        IBM Hardware
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../events.html">
                        Events
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../members.html">
                        Contributors
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the site..."
         aria-label="Search the site..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/IBM-Quantum-Technical-Enablement" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumbs">
  <ul class="bd-breadcrumbs" role="navigation" aria-label="Breadcrumb">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">Qiskit Runtime</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
<section class="tex2jax_ignore mathjax_ignore" id="qiskit-runtime">
<h1>Qiskit Runtime<a class="headerlink" href="#qiskit-runtime" title="Permalink to this heading">#</a></h1>
<section id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this heading">#</a></h2>
<p>There are several methods by which one can access IBM Quantum systems.  Each of these routines can be thought of as a <a class="reference external" href="https://en.wikipedia.org/wiki/Device_driver">device driver</a>, providing a software interface to quantum hardware.</p>
<section id="backend-run">
<h3><code class="docutils literal notranslate"><span class="pre">backend.run()</span></code><a class="headerlink" href="#backend-run" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>The original method of access to IBM Quantum systems</p></li>
<li><p>Access via <code class="docutils literal notranslate"><span class="pre">qiskit-ibm-provider</span></code> package</p></li>
<li><p>Can be viewed as an open-source, vendor agnostic device driver</p></li>
<li><p>Provides direct access to sampling data from device with no pre- or post-processing</p></li>
<li><p>Ideal for users wanting to characterize / benchmark quantum systems, or looking to develop software such as error mitigation techniques</p></li>
<li><p>Requires users to possess comprehensive knowledge of hardware details to be successful</p></li>
</ul>
</section>
<section id="id1">
<h3>Qiskit Runtime<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h3>
<p>As quantum computing matures, and users further detached from device physics gain interest, it is important to abstract as much of the knowledge required for using <code class="docutils literal notranslate"><span class="pre">backend.run()</span></code> away from users, so that focus can be on building applications and algorithms.</p>
<p>The <strong>Qiskit Runtime</strong> is a quantum device driver designed to abstract many details away from users, and give a high-fidelity managed user experience to those who prefer a more automated execution process.  Specifically, IBM Quantum knows many of the knobs that, to first-order, give best results and can be automatically set for users.  For these features, the options and code can be pushed into a cloud execution environment.</p>
<p>The Qiskit Runtime provides:</p>
<ul class="simple">
<li><p>A simple interface that abstracts away hardware details, and removes the need for boilerplate code</p></li>
<li><p>Accessed through the <code class="docutils literal notranslate"><span class="pre">qiskit-ibm-runtime</span></code> package</p></li>
<li><p>By default, does a variety of pre- and post-processing steps (including error suppression and mitigation) that aim to improve returned results</p></li>
<li><p>Can be viewed as a closed-source, vendor specific device driver</p></li>
<li><p>Ideal for users at the level of algorithms and applications</p></li>
<li><p>Not as flexible as <code class="docutils literal notranslate"><span class="pre">backend.run()</span></code></p></li>
</ul>
<p>The Runtime consists of a collection of “primitives”; common quantum computational routines that are executed in a dockerized cloud environment.  The two primitives available to date are:</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Primitive</p></th>
<th class="head"><p>What it does</p></th>
<th class="head"><p>Inputs</p></th>
<th class="head"><p>Outputs</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Sampler</strong></p></td>
<td><p>Samples circuit output distributions, possibly with error mitigation</p></td>
<td><p>Quantum circuits</p></td>
<td><p>Quasi-probability distributions [distributions with (possibly) negative values, but that sums to one]</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Estimator</strong></p></td>
<td><p>Computes expectation values for operators and states defined by circuits, possibly with error mitigation</p></td>
<td><p>Quantum circuits and operators</p></td>
<td><p>A list of expectation values (and error estimates)</p></td>
</tr>
</tbody>
</table>
<div class="alert alert-info">
   <div>
       <big><b>Info</b></big>
   </div>
   <br>
    Technically <mono>backend.run()</mono> is implemented as a Runtime program like the primitives listed above.
</div><p>In what follows, we will learn how to use the tools available via the Qiskit Runtime to execute quantum circuits on actual quantum hardware.</p>
</section>
</section>
<section id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Basic imports</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Optimization from SciPy</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span>

<span class="c1"># Basic Qiskit imports</span>
<span class="kn">from</span> <span class="nn">qiskit</span> <span class="kn">import</span> <span class="n">QuantumCircuit</span>
<span class="kn">from</span> <span class="nn">qiskit.visualization</span> <span class="kn">import</span> <span class="n">plot_distribution</span>

<span class="c1"># Operators from Qiskit and fidelity</span>
<span class="kn">from</span> <span class="nn">qiskit.quantum_info</span> <span class="kn">import</span> <span class="n">SparsePauliOp</span><span class="p">,</span> <span class="n">hellinger_fidelity</span>

<span class="c1"># Primitives from Qiskit</span>
<span class="kn">from</span> <span class="nn">qiskit.primitives</span> <span class="kn">import</span> <span class="n">Sampler</span> <span class="k">as</span> <span class="n">QiskitSampler</span>
<span class="kn">from</span> <span class="nn">qiskit.primitives</span> <span class="kn">import</span> <span class="n">Estimator</span> <span class="k">as</span> <span class="n">QiskitEstimator</span>

<span class="c1"># IBM Quantum Runtime account and primitives</span>
<span class="kn">from</span> <span class="nn">qiskit_ibm_runtime</span> <span class="kn">import</span> <span class="n">QiskitRuntimeService</span><span class="p">,</span> <span class="n">Sampler</span><span class="p">,</span> <span class="n">Estimator</span><span class="p">,</span> <span class="n">Options</span><span class="p">,</span> <span class="n">Session</span>

<span class="c1"># Primitives from the qiskit-aer simulation package</span>
<span class="kn">from</span> <span class="nn">qiskit_aer.primitives</span> <span class="kn">import</span> <span class="n">Estimator</span> <span class="k">as</span> <span class="n">AerEstimator</span>

<span class="c1"># Plotting tools</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;quantum-light&#39;</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="o">%</span><span class="k">config</span> InlineBackend.figure_format = &#39;retina&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="runtime-service-instance">
<h2>Runtime service instance<a class="headerlink" href="#runtime-service-instance" title="Permalink to this heading">#</a></h2>
<section id="saving-account-information-locally-optional">
<h3>Saving account information locally (optional)<a class="headerlink" href="#saving-account-information-locally-optional" title="Permalink to this heading">#</a></h3>
<p>If you have never used IBM Quantum hardware for your local computer, before you begin, you need to save your account information locally.  The token that needs to be saved is available on the <a class="reference external" href="https://quantum-computing.ibm.com/">IBM Quantum Platform homepage</a>.  To save the token you must run:</p>
</section>
<section id="loading-account">
<h3>Loading account<a class="headerlink" href="#loading-account" title="Permalink to this heading">#</a></h3>
<p>Provided that you have saved your account info locally, you can instantiate the service:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">service</span> <span class="o">=</span> <span class="n">QiskitRuntimeService</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>From the service we can do a variety of things.  For example, query the devices and simulators that we have access to:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">service</span><span class="o">.</span><span class="n">backends</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;IBMBackend(&#39;simulator_stabilizer&#39;)&gt;,
 &lt;IBMBackend(&#39;ibmq_quito&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_lagos&#39;)&gt;,
 &lt;IBMBackend(&#39;simulator_extended_stabilizer&#39;)&gt;,
 &lt;IBMBackend(&#39;ibmq_qasm_simulator_de&#39;)&gt;,
 &lt;IBMBackend(&#39;simulator_mps&#39;)&gt;,
 &lt;IBMBackend(&#39;simulator_statevector&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_seattle&#39;)&gt;,
 &lt;IBMBackend(&#39;ibmq_qasm_simulator&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_canberra&#39;)&gt;,
 &lt;IBMBackend(&#39;ibmq_jakarta&#39;)&gt;,
 &lt;IBMBackend(&#39;alt_cairo&#39;)&gt;,
 &lt;IBMBackend(&#39;ibmq_dublin&#39;)&gt;,
 &lt;IBMBackend(&#39;alt_auckland&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_nairobi&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_cairo&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_cleveland&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_quebec&#39;)&gt;,
 &lt;IBMBackend(&#39;ibmq_manila&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_bangkok&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_sherbrooke&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_brisbane&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_nazca&#39;)&gt;,
 &lt;IBMBackend(&#39;ibmq_mumbai&#39;)&gt;,
 &lt;IBMBackend(&#39;ibmq_belem&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_kawasaki&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_prague&#39;)&gt;,
 &lt;IBMBackend(&#39;ibmq_lima&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_peekskill&#39;)&gt;,
 &lt;IBMBackend(&#39;ibmq_kolkata&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_perth&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_wellington&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_auckland&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_kyiv&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_hanoi&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_ithaca&#39;)&gt;,
 &lt;IBMBackend(&#39;ibmq_guadalupe&#39;)&gt;,
 &lt;IBMBackend(&#39;alt_ithaca_stretch&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_algiers&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_cusco&#39;)&gt;]
</pre></div>
</div>
</div>
</div>
<p>Return a list of the previous identification numbers (<code class="docutils literal notranslate"><span class="pre">job_id</span></code>) for jobs we have submitted to any backend:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">service</span><span class="o">.</span><span class="n">jobs</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;RuntimeJob(&#39;cimm1ast4v6egaotrkr0&#39;, &#39;estimator&#39;)&gt;,
 &lt;RuntimeJob(&#39;cimaepct4v6egao7gfr0&#39;, &#39;sampler&#39;)&gt;,
 &lt;RuntimeJob(&#39;cimad8d5ear1k1gu19cg&#39;, &#39;sampler&#39;)&gt;,
 &lt;RuntimeJob(&#39;cim6v7jc243ejridc970&#39;, &#39;estimator&#39;)&gt;,
 &lt;RuntimeJob(&#39;cim5qpd5ear1k1gk4cig&#39;, &#39;estimator&#39;)&gt;,
 &lt;RuntimeJob(&#39;cim26jeuepl060qr2j6g&#39;, &#39;sampler&#39;)&gt;,
 &lt;RuntimeJob(&#39;cim264cb0ilvhaj6ngt0&#39;, &#39;sampler&#39;)&gt;,
 &lt;RuntimeJob(&#39;cim0p355ear1k1g9ul30&#39;, &#39;estimator&#39;)&gt;,
 &lt;RuntimeJob(&#39;cim0oq5lipn668bgm0k0&#39;, &#39;estimator&#39;)&gt;,
 &lt;RuntimeJob(&#39;cim0kg5lipn668bgirsg&#39;, &#39;estimator&#39;)&gt;]
</pre></div>
</div>
</div>
</div>
<p>or filter for a specific backend, etc.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">service</span><span class="o">.</span><span class="n">jobs</span><span class="p">(</span><span class="n">backend_name</span><span class="o">=</span><span class="s1">&#39;ibm_algiers&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;RuntimeJob(&#39;cild076uepl060qcdbn0&#39;, &#39;sampler&#39;)&gt;,
 &lt;RuntimeJob(&#39;cikolikb0ilvhai9s9b0&#39;, &#39;sampler&#39;)&gt;,
 &lt;RuntimeJob(&#39;cifi0mju5mrpmccdotmg&#39;, &#39;sampler&#39;)&gt;,
 &lt;RuntimeJob(&#39;cifhm7j5n9v6ta7kqqrg&#39;, &#39;sampler&#39;)&gt;,
 &lt;RuntimeJob(&#39;chjr0q46f7i49rotibq0&#39;, &#39;circuit-runner&#39;)&gt;,
 &lt;RuntimeJob(&#39;chjr0pc6f7i49rotiac0&#39;, &#39;circuit-runner&#39;)&gt;,
 &lt;RuntimeJob(&#39;chjr0olnopt07g23a1v0&#39;, &#39;circuit-runner&#39;)&gt;,
 &lt;RuntimeJob(&#39;chjr0nj7ca17j34c9mv0&#39;, &#39;circuit-runner&#39;)&gt;,
 &lt;RuntimeJob(&#39;chjr0mpike34bjgkc2h0&#39;, &#39;circuit-runner&#39;)&gt;,
 &lt;RuntimeJob(&#39;chjr0mepqnphtdto4d5g&#39;, &#39;circuit-runner&#39;)&gt;]
</pre></div>
</div>
</div>
</div>
<p>By far, the most important thing you can do from the service instance is to select a backend on which to run your circuits:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">backend</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="n">get_backend</span><span class="p">(</span><span class="s1">&#39;ibm_kyiv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="sampling-problems">
<h2>Sampling problems<a class="headerlink" href="#sampling-problems" title="Permalink to this heading">#</a></h2>
<p>Sampling problems are fundamental to quantum computation.  Indeed, at the end of the day, the only thing a quantum computer can do is sample from probability distributions.  Algorithms such as Grover’s, Bernstein-Vazarani, Shor’s, Quantum Phase Estimation (QPE), etc. all are bit-string sampling routines.  The <code class="docutils literal notranslate"><span class="pre">Sampler</span></code> routine is the runtime primitive that performs such samplings, returning a distribution to the user.</p>
<p>To begin, let us define a simple circuit generator that generates Bernstein-Vazarani circuits where the solution is the all-ones bit-string of a given length.  For example, a length 4 bit-string, requiring 5-qubits in total, is</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">bv_ones_circs</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a Bernstein-Vazarani (BV) circuit for an all-ones bit-string</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        N (int): Number of qubits in circuit.  I.e. a bit-string of length N-1</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        QuantumCircuit: BV circuit</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">barrier</span><span class="p">()</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">qc</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">qc</span> <span class="o">=</span> <span class="n">bv_ones_circs</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="s1">&#39;mpl&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/4414a9a5a5dd7bcc9cecf0ebb69d8ab17d1b6e77c654dd08a2e5c14c29006160.png" src="../../_images/4414a9a5a5dd7bcc9cecf0ebb69d8ab17d1b6e77c654dd08a2e5c14c29006160.png" />
</div>
</div>
<p>As a general rule, for small circuits, it is always good to verify that the circuit does what it is supposed to do.  This can be done with the Qiskit built-in <code class="docutils literal notranslate"><span class="pre">Sampler</span></code>, here called <code class="docutils literal notranslate"><span class="pre">QiskitSampler</span></code>, as it computes the numerically-exact answers via statevector simulation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">qiskit_sampler</span> <span class="o">=</span> <span class="n">QiskitSampler</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ideal_res</span> <span class="o">=</span> <span class="n">qiskit_sampler</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">qc</span><span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
<span class="n">ideal_res</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SamplerResult(quasi_dists=[{15: 0.9999999999999986}], metadata=[{}])
</pre></div>
</div>
</div>
</div>
<p>We see that the result object has two items.  First is <code class="docutils literal notranslate"><span class="pre">quasi_dists</span></code>, short-hand for quasi-probability distributions.  Although a quantum computer samples probability distributions, to accommodate error mitigation techniques, the type of distribution that is returned needs to be more general to include distributions that have negative values, but still sum to one.  These distributions are known as quasi-probability distributions.  The second item, <code class="docutils literal notranslate"><span class="pre">metadata</span></code>, which is empty here, is a dictionary that is used to hold additional data, as we will see.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">quasi_dist</span></code> attribute is a list with one element for each circuit given:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ideal_res</span><span class="o">.</span><span class="n">quasi_dists</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[{15: 0.9999999999999986}]
</pre></div>
</div>
</div>
</div>
<p>Quasi-distribution states are given as integers rather than bit-strings, and the values are not discrete counts, but probabilities.  This is because, as the number of qubits grows, the size of the bit-string keys grows larger than the equivalent integer representation.  We can covert this data to bit-strings if desired:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ideal_res</span><span class="o">.</span><span class="n">quasi_dists</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">binary_probabilities</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;1111&#39;: 0.9999999999999986}
</pre></div>
</div>
</div>
</div>
<p>In this form we can see that indeed, the output is the all-ones bit-string corresponding to the target integer <span class="math notranslate nohighlight">\(2^{N-1}-1\)</span>.  We now turn to executing the circuit on a real device:</p>
<p>First, we need to instantiate an instance of the <code class="docutils literal notranslate"><span class="pre">Sampler</span></code> from the Qiskit Runtime, passing our target backend to let it know which device to sample from:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sampler</span> <span class="o">=</span> <span class="n">Sampler</span><span class="p">(</span><span class="n">backend</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Beyond that, everything works pretty much the same:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">job</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">qc</span><span class="p">)</span>
<span class="c1"># Print the job_id just in case</span>
<span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;cimaepct4v6egao7gfr0&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span><span class="o">.</span><span class="n">quasi_dists</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[{0: 0.014902304247285943,
  1: 0.005586800788698605,
  2: 0.0008991701634856824,
  3: 0.004712054048460839,
  4: 0.001954636813402727,
  5: 0.0034107379767734894,
  6: 0.0005299578317401404,
  7: 0.005804150810854489,
  8: 0.0010857303469699508,
  9: 0.0003709978266879904,
  10: 0.0021122416237010708,
  11: 0.01919615110785256,
  12: -0.0004176100578495513,
  13: 0.009730275089731445,
  14: 0.014173211255548929,
  15: 0.9159491901266554}]
</pre></div>
</div>
</div>
</div>
<p>We see that our answer is no longer a single integer, but a distribution of integers with weights, some of which might be negative. That there are multiple integers in the distribution is due to noise that is present in all current-day quantum hardware.  That the probabilities can go negative, is a consequence of error mitigation (for measurement errors) being applied behind the scene.  However, we should still recover the correct answer to high-probability:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span><span class="o">.</span><span class="n">quasi_dists</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.9159491901266554
</pre></div>
</div>
</div>
</div>
<p>or in bit-string notation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span><span class="o">.</span><span class="n">quasi_dists</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">binary_probabilities</span><span class="p">()[</span><span class="s1">&#39;1&#39;</span><span class="o">*</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.9159491901266554
</pre></div>
</div>
</div>
</div>
<p>We can also plot the results.  It is best to do so with the <code class="docutils literal notranslate"><span class="pre">plot_distribution</span></code> function since our data is not discrete, i.e. not a histogram.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_distribution</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">quasi_dists</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">binary_probabilities</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/12433b38f213f4024be9339e39fe5683759a44485ce531c5cf4d48a06e496115.png" src="../../_images/12433b38f213f4024be9339e39fe5683759a44485ce531c5cf4d48a06e496115.png" />
</div>
</div>
<p>Note that, if need be, we can use the job ID to get the job result at a later time from the service object:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">service</span><span class="o">.</span><span class="n">job</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;RuntimeJob(&#39;cimaepct4v6egao7gfr0&#39;, &#39;sampler&#39;)&gt;
</pre></div>
</div>
</div>
</div>
<section id="metadata">
<h3>Metadata<a class="headerlink" href="#metadata" title="Permalink to this heading">#</a></h3>
<p>Having run on an actual device, we can now take a look at metadata again:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span><span class="o">.</span><span class="n">metadata</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[{&#39;shots&#39;: 4000,
  &#39;readout_mitigation_overhead&#39;: 1.5836261284213184,
  &#39;readout_mitigation_time&#39;: 0.08018968254327774}]
</pre></div>
</div>
</div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">metadata</span></code> now has three items.  The first, is the number of “shots”, or number of times the circuit was executed and sampled.  The number given here is the default.  The other two characterize the readout error mitigation process.</p>
</section>
<section id="things-to-be-careful-of">
<h3>Things to be careful of<a class="headerlink" href="#things-to-be-careful-of" title="Permalink to this heading">#</a></h3>
<p>With the generalization to quasi-probability distributions some things that work for canonical probability distributions do not work when negative values are encountered.  One such example is computing the fidelity between two distributions.  For example, if the quasi-probability distribution has negative values then the fidelity calculation will fail due to the use of sqrts.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hellinger_fidelity</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">quasi_dists</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">res</span><span class="o">.</span><span class="n">quasi_dists</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/paul/mambaforge/envs/qiskit/lib/python3.11/site-packages/qiskit/quantum_info/analysis/distance.py:45: RuntimeWarning: invalid value encountered in sqrt
  total += (np.sqrt(val) - np.sqrt(q_normed[key])) ** 2
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>nan
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="computing-expectation-values">
<h2>Computing expectation values<a class="headerlink" href="#computing-expectation-values" title="Permalink to this heading">#</a></h2>
<p>Most sampling algorithms are not suitable for execution on near-term quantum computers.  Instead, algorithms designed to work on noisy quantum processors typically make use of expectation values computed from the sampled distributions.  Computing expectation values can be viewed as nothing more than sampling with additional classical processing.  However, having a specialized function to do so allows removal of a lot of boilerplate code, and lets one use error mitigation techniques that are designed for mitigating expectation values only.</p>
<p>We can compute expectation values via the <code class="docutils literal notranslate"><span class="pre">Estimator</span></code> primitive. The <code class="docutils literal notranslate"><span class="pre">Estimator</span></code> requires both a quantum circuit and an operator written as a linear combination of Pauli terms.  Unlike the <code class="docutils literal notranslate"><span class="pre">Sampler</span></code> above where our circuit must have measurements attached to it, circuits sent the <code class="docutils literal notranslate"><span class="pre">Estimator</span></code> <strong>should not</strong> have any measurements!  This is because the <code class="docutils literal notranslate"><span class="pre">Estimator</span></code> will automatically add post-rotation gates to your circuit that are needed for non-diagonal observables to get the measurement basis correct.</p>
<p>Let us begin by constructing a circuit of interest.  Here we choose the “controlled-Hadamard Ladder” circuit; a circuit with no practical value, but is useful for testing:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">cntrl_hadamard_ladder</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">measurements</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a controlled-Hadamard ladder circuit</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        N (int): number</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        QuantumCircuit</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>

    <span class="n">qc</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">qc</span><span class="o">.</span><span class="n">ch</span><span class="p">(</span><span class="n">kk</span><span class="p">,</span> <span class="n">kk</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">qc</span><span class="o">.</span><span class="n">ch</span><span class="p">(</span><span class="n">kk</span><span class="p">,</span> <span class="n">kk</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">measurements</span><span class="p">:</span>
        <span class="n">qc</span><span class="o">.</span><span class="n">measure_all</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">qc</span>
</pre></div>
</div>
</div>
</div>
<p>We will create a 6-qubit version of this circuit with no measurements (as required for the <code class="docutils literal notranslate"><span class="pre">Estimator</span></code>)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">qc2</span> <span class="o">=</span> <span class="n">cntrl_hadamard_ladder</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">measurements</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> 
<span class="n">qc2</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="s1">&#39;mpl&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/bf837715d55101deca53ad8c93e9e4be1920811d1d41e52319a7186dac14be94.png" src="../../_images/bf837715d55101deca53ad8c93e9e4be1920811d1d41e52319a7186dac14be94.png" />
</div>
</div>
<p>Again, for computing expectation values we need not only a circuit that generates a quantum state, but also a operator whose value we wish to measure in that state.  Let us select 3 possible expectation values here, using the <code class="docutils literal notranslate"><span class="pre">SparsePauliOp</span></code> class to represent them:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">opers</span> <span class="o">=</span> <span class="p">[</span><span class="n">SparsePauliOp</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="o">*</span><span class="n">N</span><span class="p">),</span> <span class="n">SparsePauliOp</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="o">*</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;ZZ&#39;</span><span class="p">),</span> <span class="n">SparsePauliOp</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="o">*</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Z&#39;</span><span class="p">)]</span>
<span class="n">opers</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[SparsePauliOp([&#39;ZZZZZZ&#39;],
               coeffs=[1.+0.j]),
 SparsePauliOp([&#39;IIIIZZ&#39;],
               coeffs=[1.+0.j]),
 SparsePauliOp([&#39;IIIIIZ&#39;],
               coeffs=[1.+0.j])]
</pre></div>
</div>
</div>
</div>
<p>Like before, since the problem size is small, we can directly compute the ideal answer using the primitives built into Qiskit:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">qiskit_estimator</span> <span class="o">=</span> <span class="n">QiskitEstimator</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Because we have three operators of interest, we need to send the same circuit each time (send one circuit per operator)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ideal_res</span> <span class="o">=</span> <span class="n">qiskit_estimator</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="n">qc2</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span> <span class="n">opers</span><span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
<span class="n">ideal_res</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>EstimatorResult(values=array([ 0.4375,  0.875 , -0.875 ]), metadata=[{}, {}, {}])
</pre></div>
</div>
</div>
</div>
<p>The answers obtained are the ideal answers with no noise or finite sampling effects, and are returned as floating-point values in a NumPy array as the <code class="docutils literal notranslate"><span class="pre">values</span></code> attribute of the <code class="docutils literal notranslate"><span class="pre">EstimatorResult</span></code> object:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ideal_res</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 0.4375,  0.875 , -0.875 ])
</pre></div>
</div>
</div>
</div>
<p>Making a call to real hardware is similar to what we did for the <code class="docutils literal notranslate"><span class="pre">Sampler</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">estimator</span> <span class="o">=</span> <span class="n">Estimator</span><span class="p">(</span><span class="n">backend</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">est_res</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="n">qc2</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span> <span class="n">opers</span><span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
<span class="n">est_res</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>EstimatorResult(values=array([ 0.40582488,  0.82278218, -0.84675938]), metadata=[{&#39;variance&#39;: 1.943515457105084, &#39;shots&#39;: 4000, &#39;readout_mitigation_num_twirled_circuits&#39;: 16, &#39;readout_mitigation_shots_calibration&#39;: 8192}, {&#39;variance&#39;: 0.5761564525274007, &#39;shots&#39;: 4000, &#39;readout_mitigation_num_twirled_circuits&#39;: 16, &#39;readout_mitigation_shots_calibration&#39;: 8192}, {&#39;variance&#39;: 0.3326239158638849, &#39;shots&#39;: 4000, &#39;readout_mitigation_num_twirled_circuits&#39;: 16, &#39;readout_mitigation_shots_calibration&#39;: 8192}])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">est_res</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 0.40582488,  0.82278218, -0.84675938])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">est_res</span><span class="o">.</span><span class="n">metadata</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[{&#39;variance&#39;: 1.943515457105084,
  &#39;shots&#39;: 4000,
  &#39;readout_mitigation_num_twirled_circuits&#39;: 16,
  &#39;readout_mitigation_shots_calibration&#39;: 8192},
 {&#39;variance&#39;: 0.5761564525274007,
  &#39;shots&#39;: 4000,
  &#39;readout_mitigation_num_twirled_circuits&#39;: 16,
  &#39;readout_mitigation_shots_calibration&#39;: 8192},
 {&#39;variance&#39;: 0.3326239158638849,
  &#39;shots&#39;: 4000,
  &#39;readout_mitigation_num_twirled_circuits&#39;: 16,
  &#39;readout_mitigation_shots_calibration&#39;: 8192}]
</pre></div>
</div>
</div>
</div>
<p>New in the metadata is the <code class="docutils literal notranslate"><span class="pre">variance</span></code> field that takes into account the fact that our estimate of the expectation value has some uncertainty with it.  This combined with the number of shots is useful in error analysis.</p>
<p>Additionally, the <code class="docutils literal notranslate"><span class="pre">readout_mitigation_*</span></code> items relate to readout error mitigation, but differ from those in the <code class="docutils literal notranslate"><span class="pre">Sampler</span></code> as it uses a different method.</p>
</section>
<section id="simulators-in-runtime">
<h2>Simulators in Runtime<a class="headerlink" href="#simulators-in-runtime" title="Permalink to this heading">#</a></h2>
<p>The simulation capabilities are also available in the Qiskit Runtime.  Namely I can ask the service to show us the simulators using the <code class="docutils literal notranslate"><span class="pre">simulator</span></code> keyword argument to filter:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">service</span><span class="o">.</span><span class="n">backends</span><span class="p">(</span><span class="n">simulator</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;IBMBackend(&#39;simulator_stabilizer&#39;)&gt;,
 &lt;IBMBackend(&#39;simulator_extended_stabilizer&#39;)&gt;,
 &lt;IBMBackend(&#39;ibmq_qasm_simulator_de&#39;)&gt;,
 &lt;IBMBackend(&#39;simulator_mps&#39;)&gt;,
 &lt;IBMBackend(&#39;simulator_statevector&#39;)&gt;,
 &lt;IBMBackend(&#39;ibmq_qasm_simulator&#39;)&gt;]
</pre></div>
</div>
</div>
</div>
<p>The most useful for us will be the <code class="docutils literal notranslate"><span class="pre">ibmq_qasm_simulator</span></code> that will sample the distribution generated by a circuit, possibly under noisy evolution, a finite number of times</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sim</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="n">get_backend</span><span class="p">(</span><span class="s1">&#39;ibmq_qasm_simulator&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="setting-options">
<h2>Setting options<a class="headerlink" href="#setting-options" title="Permalink to this heading">#</a></h2>
<p>There are many options available to users of Runtime.  Chief among these is the number of shots, but there are several other important options that control how circuits are pre-processed, executed, and post-processed.  We will show how to set some of these options now</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">qiskit_estimator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">qc2</span><span class="p">,</span> <span class="n">opers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">shots</span><span class="o">=</span><span class="mi">12345</span><span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>EstimatorResult(values=array([0.4462073]), metadata=[{&#39;variance&#39;: 0.8085937499999999, &#39;shots&#39;: 12345}])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aer_estimator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">qc2</span><span class="p">,</span> <span class="n">opers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">shots</span><span class="o">=</span><span class="mi">12345</span><span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>EstimatorResult(values=array([0.44949372]), metadata=[{&#39;shots&#39;: 12345, &#39;variance&#39;: (0.7979553937434967+0j), &#39;simulator_metadata&#39;: [{&#39;parallel_state_update&#39;: 8, &#39;parallel_shots&#39;: 1, &#39;sample_measure_time&#39;: 0.008761083, &#39;noise&#39;: &#39;ideal&#39;, &#39;batched_shots_optimization&#39;: False, &#39;remapped_qubits&#39;: False, &#39;device&#39;: &#39;CPU&#39;, &#39;active_input_qubits&#39;: [0, 1, 2, 3, 4, 5], &#39;measure_sampling&#39;: True, &#39;num_clbits&#39;: 6, &#39;input_qubit_map&#39;: [[0, 0], [1, 1], [2, 2], [3, 3], [4, 4], [5, 5]], &#39;num_qubits&#39;: 6, &#39;method&#39;: &#39;statevector&#39;, &#39;fusion&#39;: {&#39;applied&#39;: False, &#39;max_fused_qubits&#39;: 5, &#39;threshold&#39;: 14, &#39;enabled&#39;: True}}]}])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sim_estimator</span> <span class="o">=</span> <span class="n">Estimator</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span>
<span class="n">sim_estimator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">qc2</span><span class="p">,</span> <span class="n">opers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">shots</span><span class="o">=</span><span class="mi">54321</span><span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>EstimatorResult(values=array([0.44139467]), metadata=[{&#39;variance&#39;: 0.8051707431678025, &#39;shots&#39;: 54321}])
</pre></div>
</div>
</div>
</div>
<section id="qiskit-runtime-options-class">
<h3>Qiskit Runtime <code class="docutils literal notranslate"><span class="pre">Options</span></code> class<a class="headerlink" href="#qiskit-runtime-options-class" title="Permalink to this heading">#</a></h3>
<p>The Qiskit runtime also supports setting options via an <code class="docutils literal notranslate"><span class="pre">Options</span></code> class.  We can see the default options by creating an empty <code class="docutils literal notranslate"><span class="pre">Options</span></code> class:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">()</span>
<span class="n">options</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Options(optimization_level=None, resilience_level=None, max_execution_time=None, transpilation=TranspilationOptions(skip_transpilation=False, initial_layout=None, layout_method=None, routing_method=None, approximation_degree=None), resilience=ResilienceOptions(noise_amplifier=&#39;TwoQubitAmplifier&#39;, noise_factors=(1, 3, 5), extrapolator=&#39;LinearExtrapolator&#39;), execution=ExecutionOptions(shots=4000, init_qubits=True), environment=EnvironmentOptions(log_level=&#39;WARNING&#39;, callback=None, job_tags=[]), simulator=SimulatorOptions(noise_model=None, seed_simulator=None, coupling_map=None, basis_gates=None))
</pre></div>
</div>
</div>
</div>
<p>There are top-level / commonly used settings such as <code class="docutils literal notranslate"><span class="pre">optimization_level</span></code>, <code class="docutils literal notranslate"><span class="pre">resilience_level</span></code>, and <code class="docutils literal notranslate"><span class="pre">max_execution_time</span></code>, and a collection of sub-options, sorted by what they do:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">options</span><span class="o">.</span><span class="n">execution</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ExecutionOptions(shots=4000, init_qubits=True)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">options</span><span class="o">.</span><span class="n">simulator</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SimulatorOptions(noise_model=None, seed_simulator=None, coupling_map=None, basis_gates=None)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">options</span><span class="o">.</span><span class="n">transpilation</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TranspilationOptions(skip_transpilation=False, initial_layout=None, layout_method=None, routing_method=None, approximation_degree=None)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">options</span><span class="o">.</span><span class="n">resilience</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ResilienceOptions(noise_amplifier=&#39;TwoQubitAmplifier&#39;, noise_factors=(1, 3, 5), extrapolator=&#39;LinearExtrapolator&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">options</span><span class="o">.</span><span class="n">execution</span><span class="o">.</span><span class="n">shots</span> <span class="o">=</span> <span class="mi">12345</span>
<span class="n">options</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Options(optimization_level=None, resilience_level=None, max_execution_time=None, transpilation=TranspilationOptions(skip_transpilation=False, initial_layout=None, layout_method=None, routing_method=None, approximation_degree=None), resilience=ResilienceOptions(noise_amplifier=&#39;TwoQubitAmplifier&#39;, noise_factors=(1, 3, 5), extrapolator=&#39;LinearExtrapolator&#39;), execution=ExecutionOptions(shots=12345, init_qubits=True), environment=EnvironmentOptions(log_level=&#39;WARNING&#39;, callback=None, job_tags=[]), simulator=SimulatorOptions(noise_model=None, seed_simulator=None, coupling_map=None, basis_gates=None))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Options</span><span class="p">(</span><span class="n">execution</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;shots&#39;</span><span class="p">:</span><span class="mi">54321</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Options(optimization_level=None, resilience_level=None, max_execution_time=None, transpilation=TranspilationOptions(skip_transpilation=False, initial_layout=None, layout_method=None, routing_method=None, approximation_degree=None), resilience=ResilienceOptions(noise_amplifier=&#39;TwoQubitAmplifier&#39;, noise_factors=(1, 3, 5), extrapolator=&#39;LinearExtrapolator&#39;), execution=ExecutionOptions(shots=54321, init_qubits=True), environment=EnvironmentOptions(log_level=&#39;WARNING&#39;, callback=None, job_tags=[]), simulator=SimulatorOptions(noise_model=None, seed_simulator=None, coupling_map=None, basis_gates=None))
</pre></div>
</div>
</div>
</div>
<p>In order to use the <code class="docutils literal notranslate"><span class="pre">Option</span></code> class, you must pass it when initializing a primitive:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sim_estimator</span> <span class="o">=</span> <span class="n">Estimator</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sim_estimator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">qc2</span><span class="p">,</span> <span class="n">opers</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>EstimatorResult(values=array([0.43232078]), metadata=[{&#39;variance&#39;: 0.8130987452183503, &#39;shots&#39;: 12345}])
</pre></div>
</div>
</div>
</div>
<p>But I can still overload the value in <code class="docutils literal notranslate"><span class="pre">run()</span></code> if I want:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sim_estimator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">qc2</span><span class="p">,</span> <span class="n">opers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">shots</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>EstimatorResult(values=array([0.8]), metadata=[{&#39;variance&#39;: 0.3599999999999999, &#39;shots&#39;: 10}])
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="runtime-sessions">
<h2>Runtime Sessions<a class="headerlink" href="#runtime-sessions" title="Permalink to this heading">#</a></h2>
<p>Part of the Qiskit Runtime is the ability to combine multiple calls to primitives together in what are called  <strong>Sessions</strong>.  The notion of session closely follows that of a <a class="reference external" href="https://en.wikipedia.org/wiki/Session_(computer_science)">networking session</a>.  Once a session is opened, users can submit multiple primitive jobs to a session, of either type of primitive, and .  Each of these jobs gets executed sequentially until either there are no more jobs to process or the session time limit is reached.</p>
<p>In general, there are two ways in which sessions can be utilized.  First, an user can execute a collection of one or more jobs that are independent.  Second, one can have two or more jobs that are interconnected, with later jobs conditioned on the results from those previously executed.  This latter case is typical for iterative algorithms such as variational methods.</p>
<p><img alt="independent" src="../../_images/independent4.png" /></p>
<p><img alt="related" src="../../_images/related3.png" /></p>
<section id="sessions-for-independent-jobs">
<h3>Sessions for independent jobs<a class="headerlink" href="#sessions-for-independent-jobs" title="Permalink to this heading">#</a></h3>
<p>There are two ways to ways to make use of sessions.  First, we can directly make a session instance using the backend instance that we want to run on:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">(</span><span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>when we create either a <code class="docutils literal notranslate"><span class="pre">Sampler</span></code> or an <code class="docutils literal notranslate"><span class="pre">Estimator</span></code>, if we pass the <code class="docutils literal notranslate"><span class="pre">session</span></code> to it, it tells the primitives that the jobs should be logically connected, and executed as a group on the quantum processor</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sampler</span> <span class="o">=</span> <span class="n">Sampler</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">)</span>
<span class="n">estimator</span> <span class="o">=</span> <span class="n">Estimator</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can now use these primitives to launch multiple jobs that will execute one after another on the QPU.  For example, lets run our previous two circuits back-to-back</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">samp_job</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">qc</span><span class="p">)</span>
<span class="n">est_job</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">qc2</span><span class="p">,</span> <span class="n">opers</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>That’s it.  We can continue to add jobs to the session at any point, provided that the total runtime of the session is not longer than the default 8hr time limit.  Once all the results are returned, we can <strong>optionally</strong> close the session:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">samp_res</span> <span class="o">=</span> <span class="n">samp_job</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
<span class="n">est_res</span> <span class="o">=</span> <span class="n">est_job</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
<span class="n">session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="alert alert-danger">
   <div>
       <big><b>Danger</b></big>
   </div>
   <br>
    If you close a session with unfinished jobs in it, then those jobs will be canceled!
</div><p>Because calling <code class="docutils literal notranslate"><span class="pre">session.close()</span></code> is messy at present, we suggest just letting the session go idle after 5 min of inactivity.</p>
<p>There is another way to use sessions, and that is via Python contexts (<code class="docutils literal notranslate"><span class="pre">with</span></code> statements).  The syntax is a bit opaque, so lets go through it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">):</span>
    <span class="c1"># We need to pass nothing to the primitives because they &quot;know&quot;</span>
    <span class="c1"># about the context block</span>
    <span class="n">sampler</span> <span class="o">=</span> <span class="n">Sampler</span><span class="p">()</span>
    <span class="n">estimator</span> <span class="o">=</span> <span class="n">Estimator</span><span class="p">()</span>
    <span class="n">samp_job</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">qc</span><span class="p">)</span>
    <span class="n">est_job</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">qc2</span><span class="p">,</span> <span class="n">opers</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>At the end of the context block, the session is not closed, and one does not have access to it anymore.</p>
<div class="alert alert-success">
   <div>
       <big><b>Upcoming feature</b></big>
   </div>
   <br>
    There will be an "I'm done" feature for sessions that will make life much easier starting around August!
</div></section>
</section>
<section id="the-headaches-of-hardware">
<h2>The headaches of hardware<a class="headerlink" href="#the-headaches-of-hardware" title="Permalink to this heading">#</a></h2>
<p>By using the Runtime we have up until now avoided any discussion of how our circuits are being executed on hardware, nor have we discussed how the properties of hardware effect the outcomes of circuit execution, in particular how things like device noise cause deviations from ideal behavior.</p>
<p>To get a feel for this, let us run our all-ones BV circuits, varying the circuit width from 2-&gt;19 qubits.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">widths</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">circs</span> <span class="o">=</span> <span class="p">[</span><span class="n">bv_ones_circs</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="k">for</span> <span class="n">N</span> <span class="ow">in</span> <span class="n">widths</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Since BV is a sampling problem, we will use the sampler primitive. We could use a session but, when possible, it is best to batch as many jobs as possible into a single job.  As such, we will send a single sampler job containing all of our circuits:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sampler</span> <span class="o">=</span> <span class="n">Sampler</span><span class="p">(</span><span class="n">backend</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bv_job</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">circs</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">1e4</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Since the target bit-string is always <code class="docutils literal notranslate"><span class="pre">'1'*(N-1)</span></code>, we can extract that probability, being careful to check if the value is there or not using <code class="docutils literal notranslate"><span class="pre">get()</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dists</span> <span class="o">=</span> <span class="n">bv_job</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">quasi_dists</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">target_probs</span> <span class="o">=</span> <span class="p">[</span><span class="n">dists</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">binary_probabilities</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="o">*</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">N</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">widths</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<p>Here I will do a fit, so that we can better see what is going on:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fitting function</span>
<span class="k">def</span> <span class="nf">sigmoid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">L</span> <span class="p">,</span><span class="n">x0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">x0</span><span class="p">)))</span> <span class="o">+</span> <span class="n">b</span>
    <span class="k">return</span> <span class="n">y</span>

<span class="c1"># Initial guess of parameters</span>
<span class="n">p0</span> <span class="o">=</span> <span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">target_probs</span><span class="p">),</span>
      <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">widths</span><span class="p">),</span>
      <span class="mi">1</span><span class="p">,</span>
      <span class="nb">min</span><span class="p">(</span><span class="n">target_probs</span><span class="p">)]</span>

<span class="c1"># Do the fitting</span>
<span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">sigmoid</span><span class="p">,</span> <span class="n">widths</span><span class="p">,</span> <span class="n">target_probs</span><span class="p">,</span> <span class="n">p0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Plot the data and fit:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">widths</span><span class="p">,</span> <span class="n">target_probs</span><span class="p">,</span> <span class="s1">&#39;--o&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">widths</span><span class="p">,</span> <span class="n">sigmoid</span><span class="p">(</span><span class="n">widths</span><span class="p">,</span> <span class="o">*</span><span class="n">popt</span><span class="p">),</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Logistics fit&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">19.5</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;# qubits&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Success probability&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/221b8673810ae9ff4ab202a075b7e68b58d8b6f3e9c40c859a8160bf1b7f08ec.png" src="../../_images/221b8673810ae9ff4ab202a075b7e68b58d8b6f3e9c40c859a8160bf1b7f08ec.png" />
</div>
</div>
<p>There is a lot of information in this plot.  First the general trend is that, as the number of qubits grows in the circuit, the overall success probability goes down.  This is not too surprising given that each operation has some error, and the more qubits there are, the more operations need to be performed.</p>
<p>However, this decrease in success is not uniform.  Up until ~5 qubits the decrease is approximately linear, after which there is a sharp drop in the success rate until finally there is no signal at all.  As we will see, the shape of this curve is dictated by the limited qubit-qubit connectivity of IBM Quantum hardware.</p>
</section>
</section>

<div class="section ablog__blog_comments">
  
  
</div>

                </article>
              
              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">Background</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#backend-run"><code class="docutils literal notranslate"><span class="pre">backend.run()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Qiskit Runtime</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setup">Setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#runtime-service-instance">Runtime service instance</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#saving-account-information-locally-optional">Saving account information locally (optional)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-account">Loading account</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sampling-problems">Sampling problems</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metadata">Metadata</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#things-to-be-careful-of">Things to be careful of</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#computing-expectation-values">Computing expectation values</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#simulators-in-runtime">Simulators in Runtime</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-options">Setting options</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#qiskit-runtime-options-class">Qiskit Runtime <code class="docutils literal notranslate"><span class="pre">Options</span></code> class</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#runtime-sessions">Runtime Sessions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sessions-for-independent-jobs">Sessions for independent jobs</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-headaches-of-hardware">The headaches of hardware</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div class="tocsection sourcelink">
    <a href="../../_sources/events/msit-2023/Runtime.ipynb.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

<footer class="bd-footer">
<div>
<p xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/">
        Content on
        <a property="dct:title" rel="cc:attributionURL" href="http://quantum-enablement.org">this website</a> 
        by <span property="cc:attributionName">IBM</span> is licensed under 
        <a href="http://creativecommons.org/licenses/by-nc/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">
                Attribution-NonCommercial 4.0 International<img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1">
                <img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1">
                <img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/nc.svg?ref=chooser-v1">
        </a>
</p> 
</div>
</footer>

  </body>
</html>