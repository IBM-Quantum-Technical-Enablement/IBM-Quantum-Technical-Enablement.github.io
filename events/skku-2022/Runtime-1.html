
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Qiskit Runtime &#8212; Enabing Technologies  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=796348d33e8b1d947c94" rel="stylesheet">
<link href="../../_static/styles/bootstrap.css?digest=796348d33e8b1d947c94" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=796348d33e8b1d947c94" rel="stylesheet">

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=796348d33e8b1d947c94" rel="stylesheet">
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2">
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2">
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94">
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/thebelab-helper.js"></script>
    <script src="../../_static/design-tabs.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-16824831-8"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'UA-16824831-8');
            </script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'events/skku-2022/Runtime-1';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="docsearch:language" content="en"> 
<link
  rel="alternate"
  type="application/atom+xml"
  href="../../explore/atom.xml"
  title="Quantum Explorations"
/>
 
<style type="text/css">
  ul.ablog-archive {
    list-style: none;
    overflow: auto;
    margin-left: 0px;
  }
  ul.ablog-archive li {
    float: left;
    margin-right: 5px;
    font-size: 80%;
  }
  ul.postlist a {
    font-style: italic;
  }
  ul.postlist-style-disc {
    list-style-type: disc;
  }
  ul.postlist-style-none {
    list-style-type: none;
  }
  ul.postlist-style-circle {
    list-style-type: circle;
  }
</style>

  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>

  
  <input type="checkbox" class="sidebar-toggle" name="__primary" id="__primary">
  <label class="overlay overlay-primary" for="__primary"></label>

  
  <input type="checkbox" class="sidebar-toggle" name="__secondary" id="__secondary">
  <label class="overlay overlay-secondary" for="__secondary"></label>

  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
      
<form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the site..." aria-label="Search the site..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
  </div>

  
  <nav class="bd-header navbar navbar-expand-lg bd-navbar" id="navbar-main"><div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
      <span class="fa-solid fa-bars"></span>
  </label>
  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../../index.html">

  
  
  
  
  
  
  

  
    <img src="../../_static/logo.png" class="logo__image only-light" alt="Logo image">
    <img src="../../_static/dark_logo.png" class="logo__image only-dark" alt="Logo image">
  
  
</a>
    
  </div>

  
  <div class="col-lg-9 navbar-header-items">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../how-to/howto.html">
                        How to guides
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../explore.html">
                        Explorations
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../hardware/hardware.html">
                        IBM Hardware
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../events.html">
                        Events
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../members.html">
                        Members
                      </a>
                    </li>
                
    </ul>
</nav>
      </div>
      
    </div>

    <div id="navbar-end">
      
        <div class="navbar-end-item navbar-persistent--container">
          
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
        </div>
      
      
      <div class="navbar-end-item">
        
<form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the site..." aria-label="Search the site..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
      </div>
      
      <div class="navbar-end-item">
        <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://github.com/IBM-Quantum-Technical-Enablement" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>


  
  
    <div class="navbar-persistent--mobile">
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
    </div>
  

  
  <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
  </label>
  

</div>
  </nav>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        
  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../how-to/howto.html">
                        How to guides
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../explore.html">
                        Explorations
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../hardware/hardware.html">
                        IBM Hardware
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../events.html">
                        Events
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../members.html">
                        Members
                      </a>
                    </li>
                
    </ul>
</nav>
      </div>
      
      </div>
    

    
    
    <div class="sidebar-header-items__end">
      
      <div class="navbar-end-item">
        
<form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the site..." aria-label="Search the site..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
      </div>
      
      <div class="navbar-end-item">
        <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://github.com/IBM-Quantum-Technical-Enablement" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
      </ul>
      </div>
      
    </div>
    
  </div>

  

  
  <div class="sidebar-end-items sidebar-primary__section">
    <div class="sidebar-end-items__item">
    </div>
  </div>

  
  <div id="rtd-footer-container"></div>

      </div>
      <main id="main-content" class="bd-main">
        
        
        <div class="bd-content">
          <div class="bd-article-container">
            
            <div class="bd-header-article">
                
            </div>
            
            
            <article class="bd-article" role="main">
               <section class="tex2jax_ignore mathjax_ignore" id="qiskit-runtime">
<h1>Qiskit Runtime<a class="headerlink" href="#qiskit-runtime" title="Permalink to this heading">#</a></h1>
<section id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this heading">#</a></h2>
<p>For the last ~3-4 years, users of IBM Quantum systems have had full control of the construction, compilation, and execution of quantum circuits on these systems.  With power comes responsibility, and users are expected to know the details of how the hardware works, and how to improve their performance via error suppresion and mitigation techniques.  This makes life difficult for those not well versed in advanced quantum computing techniques.</p>
<p><img alt="details" src="../../_images/details.png" /></p>
<p>As quantum computing matures, and users further detached from device physics gain interest, it is important to abstract as much of this knowledge away from these users, so that focus can be on building applications and algorithms.</p>
<p>The <strong>Qiskit Runtime</strong> is an execution architecture designed to abstract many of these details away from users, and give a high-fidelty managed user experience to those who prefer a more automated execution process.  Specifically, IBM Quantum knows many of the knobs that, to first-order, give best results and can be automatically set for users.  For these features, the options and code can be pushed into a cloud execution environment.</p>
<p>The Runtime is a collection of “primitive” quantum operations that execute in a dockerized cloud environment.  Currently there are two primitives that users can use:</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Primitive</p></th>
<th class="head"><p>What it does</p></th>
<th class="head"><p>Inputs</p></th>
<th class="head"><p>Outputs</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Sampler</strong></p></td>
<td><p>Samples circuit output distributions, possibly with error mitigation</p></td>
<td><p>Quantum circuits</p></td>
<td><p>Quasi-probability distributions [distributions with (possibly) negative values, but that sums to one]</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Estimator</strong></p></td>
<td><p>Computes expectation values for operators and states defined by circuits, possibly with error mitigation</p></td>
<td><p>Quantum circuits and operators</p></td>
<td><p>A list of expectation values (and error estimates)</p></td>
</tr>
</tbody>
</table>
<p>These represent additional access options to the <code class="docutils literal notranslate"><span class="pre">backend.run()</span></code> method used in previous sections.</p>
<p>In what follows, we will demonstrate how to use these primitives, and explore the benefits of abstraction, and also performance, that Runtime has to offer.</p>
</section>
<section id="frontmatter">
<h2>Frontmatter<a class="headerlink" href="#frontmatter" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">qiskit</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">qiskit.quantum_info</span> <span class="kn">import</span> <span class="n">hellinger_fidelity</span>
<span class="kn">from</span> <span class="nn">qiskit.visualization</span> <span class="kn">import</span> <span class="n">plot_distribution</span>

<span class="c1"># Operators from Qiskit</span>
<span class="kn">from</span> <span class="nn">qiskit.quantum_info</span> <span class="kn">import</span> <span class="n">SparsePauliOp</span>

<span class="c1"># Import the primitives from Qiskit</span>
<span class="kn">from</span> <span class="nn">qiskit.primitives</span> <span class="kn">import</span> <span class="n">Sampler</span><span class="p">,</span> <span class="n">Estimator</span>

<span class="c1"># Import simulator primtives from Aer</span>
<span class="kn">from</span> <span class="nn">qiskit_aer.primitives</span> <span class="kn">import</span> <span class="n">Sampler</span> <span class="k">as</span> <span class="n">AerSampler</span>
<span class="kn">from</span> <span class="nn">qiskit_aer.primitives</span> <span class="kn">import</span> <span class="n">Estimator</span> <span class="k">as</span> <span class="n">AerEstimator</span>

<span class="c1"># Plotting tools</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;quantum-light&#39;</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="o">%</span><span class="k">config</span> InlineBackend.figure_format = &#39;retina&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="basics-of-runtime">
<h2>Basics of Runtime<a class="headerlink" href="#basics-of-runtime" title="Permalink to this heading">#</a></h2>
<section id="builtin-qiskit-primitives">
<h3>Builtin Qiskit primitives<a class="headerlink" href="#builtin-qiskit-primitives" title="Permalink to this heading">#</a></h3>
<p>Qiskit itself has interfaces for working with the <code class="docutils literal notranslate"><span class="pre">Sampler</span></code> and <code class="docutils literal notranslate"><span class="pre">Estimator</span></code> primitives without accessing hardware. First, lets execute our good friend the BV circuit using the Sampler:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">bv_ones_circs</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">barrier</span><span class="p">()</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">qc</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">qc</span> <span class="o">=</span> <span class="n">bv_ones_circs</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>First, we need to instantiate an instance of the <code class="docutils literal notranslate"><span class="pre">Sampler</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sampler</span> <span class="o">=</span> <span class="n">Sampler</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">sampler</span></code> can be used much like <code class="docutils literal notranslate"><span class="pre">backend.run()</span></code> where circuits are passed, and a job instance with results is returned:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">qc</span><span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
<span class="n">res</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SamplerResult(quasi_dists=[{0: 1.2918555057623183e-134, 1: 1.959196115802348e-100, 2: 3.1355660193849558e-102, 3: 6.3395367065837045e-68, 4: 1.731144288425601e-102, 5: 5.7871241135006985e-68, 6: 7.859891699955402e-68, 7: 3.628421388053346e-34, 8: 1.6679505911645337e-99, 9: 1.1913527410433244e-67, 10: 1.3375690670228465e-67, 11: 7.924345495110263e-35, 12: 8.437378252404035e-67, 13: 1.8142106940266832e-34, 14: 5.577060207443595e-34, 15: 0.9999999999999986}], metadata=[{}])
</pre></div>
</div>
</div>
</div>
<p>The output quasi-distribution is contained in the <code class="docutils literal notranslate"><span class="pre">result.quasi_dists</span></code> attribute.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span><span class="o">.</span><span class="n">quasi_dists</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[{0: 1.2918555057623183e-134,
  1: 1.959196115802348e-100,
  2: 3.1355660193849558e-102,
  3: 6.3395367065837045e-68,
  4: 1.731144288425601e-102,
  5: 5.7871241135006985e-68,
  6: 7.859891699955402e-68,
  7: 3.628421388053346e-34,
  8: 1.6679505911645337e-99,
  9: 1.1913527410433244e-67,
  10: 1.3375690670228465e-67,
  11: 7.924345495110263e-35,
  12: 8.437378252404035e-67,
  13: 1.8142106940266832e-34,
  14: 5.577060207443595e-34,
  15: 0.9999999999999986}]
</pre></div>
</div>
</div>
</div>
<p>Unlike the usual <code class="docutils literal notranslate"><span class="pre">Counts</span></code> returned via <code class="docutils literal notranslate"><span class="pre">backend.run()</span></code> the quasi-distribution states are given as integers rather than bit-strings, and the values are not discrete counts.  This is because, as the number of qubits grows, the size of the bit-string keys grows much larger than the equivilent integer representation.</p>
<p>We can use these quasi-distributions to do basically everything the <code class="docutils literal notranslate"><span class="pre">Counts</span></code> was used for.  e.g. we can compute fidelities:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hellinger_fidelity</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">quasi_dists</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">{</span><span class="mi">15</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.0
</pre></div>
</div>
</div>
</div>
<p>alternatively one can work in bit-strings:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hellinger_fidelity</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">quasi_dists</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">binary_probabilities</span><span class="p">(),</span> <span class="p">{</span><span class="s1">&#39;1&#39;</span><span class="o">*</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span> <span class="mi">1</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.0
</pre></div>
</div>
</div>
</div>
<p>We can also plot the results.  It is best to do so with the new <code class="docutils literal notranslate"><span class="pre">plot_distribution</span></code> function since our data is not discrete</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_distribution</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">quasi_dists</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">binary_probabilities</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/34cc7ea5dc8744c14609b5091dece661941fe3f6c3caf18428c779f9e3a5c2a8.png" src="../../_images/34cc7ea5dc8744c14609b5091dece661941fe3f6c3caf18428c779f9e3a5c2a8.png" />
</div>
</div>
<p>We can also look at computing expectation values via the <code class="docutils literal notranslate"><span class="pre">Estimator</span></code>.  Unlike the <code class="docutils literal notranslate"><span class="pre">Sampler</span></code> above where our circuit must have measurements attached to it, circuits sent the <code class="docutils literal notranslate"><span class="pre">Estimator</span></code> <strong>should not</strong> have any measurements!  This is because the <code class="docutils literal notranslate"><span class="pre">Estimator</span></code> will automatically add the necessary post-rotation gates to your circuit to get the measurement basis correct.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">cntrl_hadamard_ladder</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">measurements</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>

    <span class="n">qc</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">qc</span><span class="o">.</span><span class="n">ch</span><span class="p">(</span><span class="n">kk</span><span class="p">,</span> <span class="n">kk</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">qc</span><span class="o">.</span><span class="n">ch</span><span class="p">(</span><span class="n">kk</span><span class="p">,</span> <span class="n">kk</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">measurements</span><span class="p">:</span>
        <span class="n">qc</span><span class="o">.</span><span class="n">measure_all</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">qc</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">qc2</span> <span class="o">=</span> <span class="n">cntrl_hadamard_ladder</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> 
<span class="n">qc2</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="s1">&#39;mpl&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/85c582dc229fc2445d70a103ccb2978515a65de4d3b5fe400cdbf0efb2f7bf1e.png" src="../../_images/85c582dc229fc2445d70a103ccb2978515a65de4d3b5fe400cdbf0efb2f7bf1e.png" />
</div>
</div>
<p>Let us compute the operator <span class="math notranslate nohighlight">\(\langle Z^{\otimes N}\rangle\)</span> on the state generated by the above circuit.  Again, we need to first create an instance of our primitive.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">estimator</span> <span class="o">=</span> <span class="n">Estimator</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>and now need to specify our operator in terms of a operator class that Qiskit understands</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">oper</span> <span class="o">=</span> <span class="n">SparsePauliOp</span><span class="o">.</span><span class="n">from_list</span><span class="p">([(</span><span class="s1">&#39;Z&#39;</span><span class="o">*</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">)])</span>
</pre></div>
</div>
</div>
</div>
<p>We can feed the circuits and operators into <code class="docutils literal notranslate"><span class="pre">estimator.run()</span></code> and get a result back:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">est_res</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">qc2</span><span class="p">,</span> <span class="n">oper</span><span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
<span class="n">est_res</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>EstimatorResult(values=array([0.4375]), metadata=[{}])
</pre></div>
</div>
</div>
</div>
<p>The only return value(s) when calling the <code class="docutils literal notranslate"><span class="pre">Estimator</span></code> are the expectation values for the operators we have given, and some optional metadata that returns additional data.  Both the <code class="docutils literal notranslate"><span class="pre">Sampler</span></code> and <code class="docutils literal notranslate"><span class="pre">Estimator</span></code> from Qiskit use a statevector simulation to obtain their results, so the results are accurate to machine precision:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">est_res</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.4374999999999992
</pre></div>
</div>
</div>
</div>
</section>
<section id="primitives-in-aer">
<h3>Primitives in Aer<a class="headerlink" href="#primitives-in-aer" title="Permalink to this heading">#</a></h3>
<p>Like Qiskit, the Aer simulator has its own version of the <code class="docutils literal notranslate"><span class="pre">Estimator</span></code> and <code class="docutils literal notranslate"><span class="pre">Sampler</span></code> that sample the final statevector in the computational basis rather than return it wholesale.  We can use them in a similar manner:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aer_sampler</span> <span class="o">=</span> <span class="n">AerSampler</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aer_samp_res</span> <span class="o">=</span> <span class="n">aer_sampler</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="mf">1e4</span><span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
<span class="n">aer_samp_res</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SamplerResult(quasi_dists=[{15: 1.0}], metadata=[{&#39;shots&#39;: 10000, &#39;simulator_metadata&#39;: {&#39;parallel_state_update&#39;: 8, &#39;parallel_shots&#39;: 1, &#39;sample_measure_time&#39;: 0.005897375, &#39;noise&#39;: &#39;ideal&#39;, &#39;batched_shots_optimization&#39;: False, &#39;remapped_qubits&#39;: False, &#39;device&#39;: &#39;CPU&#39;, &#39;active_input_qubits&#39;: [0, 1, 2, 3, 4], &#39;measure_sampling&#39;: True, &#39;num_clbits&#39;: 4, &#39;input_qubit_map&#39;: [[4, 4], [3, 3], [2, 2], [1, 1], [0, 0]], &#39;num_qubits&#39;: 5, &#39;method&#39;: &#39;statevector&#39;, &#39;fusion&#39;: {&#39;applied&#39;: False, &#39;max_fused_qubits&#39;: 5, &#39;threshold&#39;: 14, &#39;enabled&#39;: True}}}])
</pre></div>
</div>
</div>
</div>
<p>We now see that the <code class="docutils literal notranslate"><span class="pre">metadata</span></code> attribute of the result class is populated with a collection of items related to the simulation parameters used, and the number of samples (“shots”) taken from the distribution. Similar for the <code class="docutils literal notranslate"><span class="pre">Estimator</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aer_estimator</span> <span class="o">=</span> <span class="n">AerEstimator</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aer_est_res</span> <span class="o">=</span> <span class="n">aer_estimator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">qc2</span><span class="p">,</span> <span class="n">oper</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="mf">1e4</span><span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
<span class="n">aer_est_res</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>EstimatorResult(values=array([0.442]), metadata=[{&#39;shots&#39;: 10000, &#39;variance&#39;: 0.804636, &#39;simulator_metadata&#39;: [{&#39;parallel_state_update&#39;: 8, &#39;parallel_shots&#39;: 1, &#39;sample_measure_time&#39;: 0.004706916, &#39;noise&#39;: &#39;ideal&#39;, &#39;batched_shots_optimization&#39;: False, &#39;remapped_qubits&#39;: False, &#39;device&#39;: &#39;CPU&#39;, &#39;active_input_qubits&#39;: [0, 1, 2, 3, 4, 5], &#39;measure_sampling&#39;: True, &#39;num_clbits&#39;: 6, &#39;input_qubit_map&#39;: [[5, 5], [4, 4], [3, 3], [2, 2], [1, 1], [0, 0]], &#39;num_qubits&#39;: 6, &#39;method&#39;: &#39;statevector&#39;, &#39;fusion&#39;: {&#39;applied&#39;: False, &#39;max_fused_qubits&#39;: 5, &#39;threshold&#39;: 14, &#39;enabled&#39;: True}}]}])
</pre></div>
</div>
</div>
</div>
<p>however we now see a “variance” field in the metadata that takes into account the fact that our estimate of the expectation value has some uncertainty with it.  This combined with the number of shots is useful in error analysis.</p>
</section>
</section>
<section id="sampler-vs-estimator">
<h2>Sampler vs Estimator<a class="headerlink" href="#sampler-vs-estimator" title="Permalink to this heading">#</a></h2>
<p>We now turn to the question as to why there is both a <code class="docutils literal notranslate"><span class="pre">Sampler</span></code> and an <code class="docutils literal notranslate"><span class="pre">Estimator</span></code>?  Indeed, the quantum computer itself is already sampling the output distribution, and computing the expectation value from that distribution is not computationally expensive.  So why have both?</p>
<p>There are two primary reasons as to why one needs an <code class="docutils literal notranslate"><span class="pre">Estimator</span></code> interfeace along side that of the <code class="docutils literal notranslate"><span class="pre">Sampler</span></code>.  Firstly, there are data size considerations that come into play.</p>
<p><img alt="workflow" src="../../_images/workflow.png" /></p>
<p>As the number of qubits and samples taken grows, there is a large overhead inherent in sending the entire dictionary of counts over a network to the user.  For many near-term applications of interest, the necessary output is expectation values that can be represented by a single floating-point number (an additional number if computing error bounds as well).  Note that, for many sampling problems of interest, only the most probable bit-string is of interest, indicating that IO savings for sampling is also possible.</p>
<p>The second reason has to do with error mitigation.  There are some methods that are more suited to computations for expectation values than for distributions.  As such, when thinking about automating workflows for end users that include error mitigation, the partitioning of <code class="docutils literal notranslate"><span class="pre">Sampler</span></code> and <code class="docutils literal notranslate"><span class="pre">Estimator</span></code> makes sense from an implimentation point of view.</p>
</section>
</section>

<div class="section">
   
</div>

            </article>
            
            
            
            <footer class="bd-footer-article">
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            </footer>
            
          </div>
          
          
          
            <div class="bd-sidebar-secondary bd-toc">
              
<div class="toc-item">
  
<div class="tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
</div>
<nav id="bd-toc-nav" class="page-toc">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#background">
   Background
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#frontmatter">
   Frontmatter
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#basics-of-runtime">
   Basics of Runtime
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#builtin-qiskit-primitives">
     Builtin Qiskit primitives
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#primitives-in-aer">
     Primitives in Aer
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sampler-vs-estimator">
   Sampler vs Estimator
  </a>
 </li>
</ul>

</nav>
</div>

<div class="toc-item">
  
<div id="searchbox"></div>
</div>

<div class="toc-item">
  
</div>

<div class="toc-item">
  
<div class="tocsection sourcelink">
    <a href="../../_sources/events/skku-2022/Runtime-1.ipynb.txt">
        <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
</div>

</div>

            </div>
          
          
        </div>
        <footer class="bd-footer-content">
          <div class="bd-footer-content__inner">
            
          </div>
        </footer>
        
      </main>
    </div>
  </div>

  
    
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94"></script>

<footer class="bd-footer">
<div>
<p xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/">
        Content on
        <a property="dct:title" rel="cc:attributionURL" href="http://quantum-enablement.org">this website</a> 
        by <span property="cc:attributionName">IBM</span> is licensed under 
        <a href="http://creativecommons.org/licenses/by-nc/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">
                Attribution-NonCommercial 4.0 International<img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1">
                <img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1">
                <img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/nc.svg?ref=chooser-v1">
        </a>
</p> 
</div>
</footer>

  </body>
</html>