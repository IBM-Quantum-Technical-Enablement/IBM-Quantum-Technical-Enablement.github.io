
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Dynamic circuits - II &#8212; Enabing Technologies  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=796348d33e8b1d947c94" rel="stylesheet">
<link href="../../_static/styles/bootstrap.css?digest=796348d33e8b1d947c94" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=796348d33e8b1d947c94" rel="stylesheet">

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=796348d33e8b1d947c94" rel="stylesheet">
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2">
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2">
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94">
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/thebelab-helper.js"></script>
    <script src="../../_static/design-tabs.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-16824831-8"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'UA-16824831-8');
            </script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'events/skku-2022/dynamic-circuits-2';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="docsearch:language" content="en"> 
<link
  rel="alternate"
  type="application/atom+xml"
  href="../../explore/atom.xml"
  title="Quantum Explorations"
/>
 
<style type="text/css">
  ul.ablog-archive {
    list-style: none;
    overflow: auto;
    margin-left: 0px;
  }
  ul.ablog-archive li {
    float: left;
    margin-right: 5px;
    font-size: 80%;
  }
  ul.postlist a {
    font-style: italic;
  }
  ul.postlist-style-disc {
    list-style-type: disc;
  }
  ul.postlist-style-none {
    list-style-type: none;
  }
  ul.postlist-style-circle {
    list-style-type: circle;
  }
</style>

  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>

  
  <input type="checkbox" class="sidebar-toggle" name="__primary" id="__primary">
  <label class="overlay overlay-primary" for="__primary"></label>

  
  <input type="checkbox" class="sidebar-toggle" name="__secondary" id="__secondary">
  <label class="overlay overlay-secondary" for="__secondary"></label>

  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
      
<form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the site..." aria-label="Search the site..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
  </div>

  
  <nav class="bd-header navbar navbar-expand-lg bd-navbar" id="navbar-main"><div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
      <span class="fa-solid fa-bars"></span>
  </label>
  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../../index.html">

  
  
  
  
  
  
  

  
    <img src="../../_static/logo.png" class="logo__image only-light" alt="Logo image">
    <img src="../../_static/dark_logo.png" class="logo__image only-dark" alt="Logo image">
  
  
</a>
    
  </div>

  
  <div class="col-lg-9 navbar-header-items">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../how-to/howto.html">
                        How to guides
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../explore.html">
                        Explorations
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../hardware/hardware.html">
                        IBM Hardware
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../events.html">
                        Events
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../members.html">
                        Members
                      </a>
                    </li>
                
    </ul>
</nav>
      </div>
      
    </div>

    <div id="navbar-end">
      
        <div class="navbar-end-item navbar-persistent--container">
          
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
        </div>
      
      
      <div class="navbar-end-item">
        
<form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the site..." aria-label="Search the site..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
      </div>
      
      <div class="navbar-end-item">
        <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://github.com/IBM-Quantum-Technical-Enablement" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>


  
  
    <div class="navbar-persistent--mobile">
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
    </div>
  

  
  <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
  </label>
  

</div>
  </nav>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        
  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../how-to/howto.html">
                        How to guides
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../explore.html">
                        Explorations
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../hardware/hardware.html">
                        IBM Hardware
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../events.html">
                        Events
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../members.html">
                        Members
                      </a>
                    </li>
                
    </ul>
</nav>
      </div>
      
      </div>
    

    
    
    <div class="sidebar-header-items__end">
      
      <div class="navbar-end-item">
        
<form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the site..." aria-label="Search the site..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
      </div>
      
      <div class="navbar-end-item">
        <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://github.com/IBM-Quantum-Technical-Enablement" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
      </ul>
      </div>
      
    </div>
    
  </div>

  

  
  <div class="sidebar-end-items sidebar-primary__section">
    <div class="sidebar-end-items__item">
    </div>
  </div>

  
  <div id="rtd-footer-container"></div>

      </div>
      <main id="main-content" class="bd-main">
        
        
        <div class="bd-content">
          <div class="bd-article-container">
            
            <div class="bd-header-article">
                
            </div>
            
            
            <article class="bd-article" role="main">
               <p><img alt="beta" src="../../_images/beta-version1.jpg" /></p>
<section class="tex2jax_ignore mathjax_ignore" id="dynamic-circuits-ii">
<h1>Dynamic circuits - II<a class="headerlink" href="#dynamic-circuits-ii" title="Permalink to this heading">#</a></h1>
<div class="alert alert-warning">
    This notebook is requires installing the <tt>qiskit-ibm-provider</tt>:
    <ul>
        <li>Qiskit IBM Provider: <tt>pip install qiskit-ibm-provider</tt></li>
    </ul>
</div><section id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this heading">#</a></h2>
<section id="qiskit-ibm-provider">
<h3>qiskit-ibm-provider<a class="headerlink" href="#qiskit-ibm-provider" title="Permalink to this heading">#</a></h3>
<p>Up until now we have used <code class="docutils literal notranslate"><span class="pre">IBMQ.load_account()</span></code> and other functionality of the <code class="docutils literal notranslate"><span class="pre">qiskit-ibmq-provider</span></code> package that comes installed when doing <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">qiskit</span></code>.  This has been the manner in which IBM Quantum systems have been accessed for the last 3.5 years.  Given the present-day status of quantum technology 3.5 years is an eternity, and some design decisions from long-ago have now come to haunt us.  As such, to better implement things like dynamic circuits, better support for more complex hardware configurations, etc, the internal quantum circuit compilation pipeline had to be reworked.</p>
<p><img alt="updates" src="../../_images/updates.png" /></p>
<p>Because of the number of changes required in the underlying software and hardware, as well as a bit of marketing, IBM Quantum decided that a new package was needed to accomplish what needs to be done.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">qiskit-ibm-provider</span></code> is one of two ways to access IBM hardware going forward (the other is the Runtime, which we will discuss shortly).  We could have used this package earlier, but currently there are some limitations:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>1. The Aer simulator currently cannot build a noisy from a backend from the new provider (V2 backends)
</pre></div>
</div>
<p>Because a lot of work involves noisy simulations, this greatly limits the usefulness of this new provider until this is fixed in Aer.</p>
</section>
<section id="dynamic-circuits">
<h3>Dynamic circuits<a class="headerlink" href="#dynamic-circuits" title="Permalink to this heading">#</a></h3>
<p>So far we have used only basic dynamic circuits with measurement and reset pairs.  While useful, these capabilities alone do not enable the full richness of dynamic circuits.  Rather we really want generic expressions involving things like <code class="docutils literal notranslate"><span class="pre">for/if-else/when</span></code> statements that allow for branching.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">qiskit-ibm-provider</span></code> allows for passing dynamic circuits with branching logic such as that listed above using <code class="docutils literal notranslate"><span class="pre">dynamic=True</span></code> keyword argument in <code class="docutils literal notranslate"><span class="pre">backend.run()</span></code>.  That is to say, to execute a dynamic circuit job we will use code that looks like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="n">job</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">circuits</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="n">shots</span><span class="p">,</span> <span class="n">dynamic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">dynamic=True</span></code> tells the control software to use the updated pathway for dynamic circuits.  Conversely, the default <code class="docutils literal notranslate"><span class="pre">dynamic=False</span></code> option uses the legacy pipeline, and thus cannot handle general dynamic circuits.</p>
<p>In what follows we will begin to explore dynamic circuits through several example circuits, starting once again with our BV example</p>
</section>
</section>
<section id="frontmatter">
<h2>Frontmatter<a class="headerlink" href="#frontmatter" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">qiskit</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">qiskit.quantum_info</span> <span class="kn">import</span> <span class="n">hellinger_fidelity</span>

<span class="c1"># Transpiler passes for optimizing dynamic circuits</span>
<span class="kn">from</span> <span class="nn">qiskit.transpiler</span> <span class="kn">import</span> <span class="n">PassManager</span>
<span class="kn">from</span> <span class="nn">qiskit.transpiler.passes.optimization</span> <span class="kn">import</span> <span class="n">ResetAfterMeasureSimplification</span>

<span class="c1"># Load the QASM3 exporter</span>
<span class="kn">from</span> <span class="nn">qiskit</span> <span class="kn">import</span> <span class="n">qasm3</span>

<span class="c1"># Plotting tools</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;quantum-light&#39;</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="o">%</span><span class="k">config</span> InlineBackend.figure_format = &#39;retina&#39;
</pre></div>
</div>
</div>
</div>
<section id="ibm-provider-and-backend-selection">
<h3>IBM Provider and backend selection<a class="headerlink" href="#ibm-provider-and-backend-selection" title="Permalink to this heading">#</a></h3>
<p>We begin by importing what we need from the new IBM provider.  The syntax for doing so is a bit different than the older <code class="docutils literal notranslate"><span class="pre">IBMQ</span></code> way that usually comes as a part of Qiskit:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qiskit_ibm_provider</span> <span class="kn">import</span> <span class="n">IBMProvider</span>

<span class="n">provider</span> <span class="o">=</span> <span class="n">IBMProvider</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>We can now look to see what backends are available:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">provider</span><span class="o">.</span><span class="n">backends</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;IBMBackend(&#39;ibmq_qasm_simulator&#39;)&gt;,
 &lt;IBMBackend(&#39;ibmq_qasm_simulator_de&#39;)&gt;,
 &lt;IBMBackend(&#39;ibmq_quito&#39;)&gt;,
 &lt;IBMBackend(&#39;simulator_statevector&#39;)&gt;,
 &lt;IBMBackend(&#39;simulator_mps&#39;)&gt;,
 &lt;IBMBackend(&#39;simulator_extended_stabilizer&#39;)&gt;,
 &lt;IBMBackend(&#39;simulator_stabilizer&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_lagos&#39;)&gt;,
 &lt;IBMBackend(&#39;ibmq_montreal&#39;)&gt;,
 &lt;IBMBackend(&#39;ibmq_toronto&#39;)&gt;,
 &lt;IBMBackend(&#39;ibmq_dublin&#39;)&gt;,
 &lt;IBMBackend(&#39;ibmq_kolkata&#39;)&gt;,
 &lt;IBMBackend(&#39;ibmq_mumbai&#39;)&gt;,
 &lt;IBMBackend(&#39;ibmq_lima&#39;)&gt;,
 &lt;IBMBackend(&#39;ibmq_belem&#39;)&gt;,
 &lt;IBMBackend(&#39;ibmq_guadalupe&#39;)&gt;,
 &lt;IBMBackend(&#39;ibmq_jakarta&#39;)&gt;,
 &lt;IBMBackend(&#39;ibmq_manila&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_bangkok&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_hanoi&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_kawasaki&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_nairobi&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_cairo&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_auckland&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_perth&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_wellington&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_peekskill&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_washington&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_ithaca&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_oslo&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_geneva&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_kyiv&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_prague&#39;)&gt;,
 &lt;IBMBackend(&#39;alt_auckland&#39;)&gt;,
 &lt;IBMBackend(&#39;alt_cairo&#39;)&gt;,
 &lt;IBMBackend(&#39;alt_ithaca_stretch&#39;)&gt;,
 &lt;IBMBackend(&#39;alt_montreal&#39;)&gt;,
 &lt;IBMBackend(&#39;simulator_qasm3&#39;)&gt;,
 &lt;IBMBackend(&#39;ibmq_bogota&#39;)&gt;]
</pre></div>
</div>
</div>
</div>
<p>You can see that there are a large number of backends here, but I did not specify the Hub. Group, or Project (HGP) that is to be used.  Rather, the new provider object automatically selects the HGP for you following <a class="reference external" href="https://qiskit.org/documentation/partners/qiskit_ibm_provider/stubs/qiskit_ibm_provider.IBMProvider.html#ibmprovider">a list of rules</a>.  If one wants to specify the HGP they are going to use, then it is done via the <code class="docutils literal notranslate"><span class="pre">instance</span></code> keyword argument. E.g. if I want only the open systems then I can do:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Specify a source in the format: hub/group/project.</span>
<span class="n">open_provider</span> <span class="o">=</span> <span class="n">IBMProvider</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="s2">&quot;ibm-q/open/main&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Note that as of version <code class="docutils literal notranslate"><span class="pre">0.1.0</span></code>, the above code returns all backends: <a class="reference external" href="https://github.com/Qiskit/qiskit-ibm-provider/issues/454">Github Issue #454</a></p>
<p>Let us now select the system on which we wish to run our dynamic circuits:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">backend</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="n">get_backend</span><span class="p">(</span><span class="s1">&#39;ibm_peekskill&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Note that not all systems support dynamic circuits.  In order to find out which ones do, one can look for the <code class="docutils literal notranslate"><span class="pre">qasm3</span></code> string in the supported features:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">backend</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span><span class="o">.</span><span class="n">supported_features</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;qobj&#39;, &#39;qasm3&#39;]
</pre></div>
</div>
</div>
</div>
<p>Or one can filter for systems supporting dynamic circuits:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">provider</span><span class="o">.</span><span class="n">backends</span><span class="p">(</span><span class="n">dynamic_circuits</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;IBMBackend(&#39;ibm_lagos&#39;)&gt;,
 &lt;IBMBackend(&#39;ibmq_dublin&#39;)&gt;,
 &lt;IBMBackend(&#39;ibmq_kolkata&#39;)&gt;,
 &lt;IBMBackend(&#39;ibmq_mumbai&#39;)&gt;,
 &lt;IBMBackend(&#39;ibmq_jakarta&#39;)&gt;,
 &lt;IBMBackend(&#39;ibmq_manila&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_kawasaki&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_nairobi&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_auckland&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_perth&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_wellington&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_peekskill&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_washington&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_oslo&#39;)&gt;,
 &lt;IBMBackend(&#39;ibm_geneva&#39;)&gt;,
 &lt;IBMBackend(&#39;alt_auckland&#39;)&gt;,
 &lt;IBMBackend(&#39;simulator_qasm3&#39;)&gt;]
</pre></div>
</div>
</div>
</div>
<div class="alert alert-danger">
   <div>
       <big><b>Warning</b></big>
   </div>
   <br>
   "Support" for dynamic circuits does not mean it is actually fully operational!  Your mileage may vary.
</div></section>
</section>
<section id="dynamic-bv">
<h2>Dynamic BV<a class="headerlink" href="#dynamic-bv" title="Permalink to this heading">#</a></h2>
<p>In our previous look at dynamic BV we had circuits with many measurement+reset pairs.  Repeating our circuit generation code here:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">dynamic_bv</span><span class="p">(</span><span class="n">bitstring</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a Bernstein-Vazirani circuit from a given bitstring.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        bitstring (str): A bitstring.</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        QuantumCircuit: Output circuit.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">bitstring</span><span class="p">))</span>
    
    <span class="c1"># Prepare the |-x&gt; state on target qubit</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="c1"># For each bit (0 or 1) build a simple circuit block</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">bit</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bitstring</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        
        <span class="c1"># Initial H gate on control</span>
        <span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># If bit=1, do a CNOT gate</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">bit</span><span class="p">):</span>
            <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># Final H gate to convert phase to computational-basis</span>
        <span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># Measure</span>
        <span class="n">qc</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">idx</span><span class="p">)</span>
        
        <span class="c1"># If not at the final bit, recycle and reset qubits</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="o">!=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bitstring</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="c1"># Reset control qubit for reuse</span>
            <span class="n">qc</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="c1"># reset target qubit to minimize dephasing</span>
            <span class="n">qc</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1"># Prepare the |-x&gt; state on target qubit again</span>
            <span class="n">qc</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">qc</span>
</pre></div>
</div>
</div>
</div>
<p>Let us generate circuits for bit-string lengths of 2 -&gt; 13:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dyn_bv_circs</span> <span class="o">=</span> <span class="p">[</span><span class="n">dynamic_bv</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="o">*</span><span class="n">N</span><span class="p">)</span> <span class="k">for</span> <span class="n">N</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">13</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<p>Let use plot the length=3 BV circuit</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dyn_bv_circs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="s1">&#39;mpl&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/f94770ee12748d3547f50666c230e62c556bcdf59f9764a6c9898f42d96b8691.png" src="../../_images/f94770ee12748d3547f50666c230e62c556bcdf59f9764a6c9898f42d96b8691.png" />
</div>
</div>
<p>Because the new IBM provider allows us to toggle the internal circuit compilation pipeline using <code class="docutils literal notranslate"><span class="pre">dynamic=True</span></code>, lets begin by testing the legacy and new pipelines on these familiar circuits.</p>
<p>Here I will manually select qubits 8 and 9 since their calibration readout errors look good.  First we transpile:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dyn_trans_qc</span> <span class="o">=</span> <span class="n">transpile</span><span class="p">(</span><span class="n">dyn_bv_circs</span><span class="p">,</span> <span class="n">backend</span><span class="p">,</span> <span class="n">optimization_level</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">initial_layout</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>And now we execute the batch of circuits twice.  First, using the new dynamic circuits pathway, and second using the old way:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">job1</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">dyn_trans_qc</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">dynamic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">job2</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">dyn_trans_qc</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>we now collect the results,</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">new_bv_counts</span> <span class="o">=</span> <span class="n">job1</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()</span>
<span class="n">old_bv_counts</span> <span class="o">=</span> <span class="n">job2</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>and compute the resulting fidelities:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dyn_fidelities</span> <span class="o">=</span> <span class="p">[</span><span class="n">hellinger_fidelity</span><span class="p">(</span><span class="n">cnts</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;1&#39;</span><span class="o">*</span><span class="p">(</span><span class="n">idx</span><span class="o">+</span><span class="mi">2</span><span class="p">):</span> <span class="mi">1</span><span class="p">})</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">cnts</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">new_bv_counts</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reg_fidelities</span> <span class="o">=</span> <span class="p">[</span><span class="n">hellinger_fidelity</span><span class="p">(</span><span class="n">cnts</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;1&#39;</span><span class="o">*</span><span class="p">(</span><span class="n">idx</span><span class="o">+</span><span class="mi">2</span><span class="p">):</span> <span class="mi">1</span><span class="p">})</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">cnts</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">old_bv_counts</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<p>We now plot our results.  Because these are the exact same circuits and running on the same device, we expect that the answers closely match, up to perhaps finite sampling noise.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">13</span><span class="p">),</span> <span class="n">reg_fidelities</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Legacy-pipeline&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">13</span><span class="p">),</span> <span class="n">dyn_fidelities</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;QASM3-pipeline&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Bits&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Fidelity&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/cea30c52609933618e7317763d4b6f20713dfd51f520cc3ef877a734c8b957ed.png" src="../../_images/cea30c52609933618e7317763d4b6f20713dfd51f520cc3ef877a734c8b957ed.png" />
</div>
</div>
<p>Well, we see that the results do not agree at all, 😞, and that the old pipeline is quite a bit better.  The reason for this is likely due to the beta nature of the new pipeline; there are some tweaks to timing and gates that still needs to be done.  There is not much we can do about this, so lets just see if we can improve upon these results.</p>
</section>
<section id="measure-reset-pair-simplification">
<h2>Measure+reset pair simplification<a class="headerlink" href="#measure-reset-pair-simplification" title="Permalink to this heading">#</a></h2>
<p>Our current performance bottleneck is measure+reset pairs in the circuits, ie.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="s1">&#39;mpl&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/b4f15a5801458f4fddfc6f849863759e7b3780c4e2ef0b26be778c981dc5e16a.png" src="../../_images/b4f15a5801458f4fddfc6f849863759e7b3780c4e2ef0b26be778c981dc5e16a.png" />
</div>
</div>
<p>We have seen that a reset on IBM Quantum systems is itself a measurement followed by a conditional x-gate.  Thus the full circuit looks a bit like:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">qc2</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">qc2</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">qc2</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">qc2</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">c_if</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">qc2</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="s1">&#39;mpl&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/7e1be87fcd64b9f3e34e3c4b6312a5fee88334101018b73c91f8100d734b0511.png" src="../../_images/7e1be87fcd64b9f3e34e3c4b6312a5fee88334101018b73c91f8100d734b0511.png" />
</div>
</div>
<p>Now, we have already seen that measurements are the most error prone operations on IBM Quantum systems, and take quite a bit of time (~2 CX gates worth of time).  On this device, the average measurement error rate is</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">backend</span><span class="o">.</span><span class="n">properties</span><span class="p">()</span><span class="o">.</span><span class="n">readout_error</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span> <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">backend</span><span class="o">.</span><span class="n">num_qubits</span><span class="p">)])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.01950740740740739
</pre></div>
</div>
</div>
</div>
<p>So every <code class="docutils literal notranslate"><span class="pre">measure</span></code>+<code class="docutils literal notranslate"><span class="pre">reset</span></code> pair is quite costly in terms of both error and duration.  If we could reduce the number of measurements, then the performance would greatly improve.  It turns out that we can.  Specifically, when measuring the state of a quantum system <span class="math notranslate nohighlight">\(|\psi\rangle\)</span>, the state is projected onto one of the eigenstates of the corresponding measurement operator.  In this case that is one basis states in the computational basis.  Immediately after the measurement, the state would begin to evolve again until acted upon by another measurement or projective operation such as a noisy Kraus operator.  However, if our measurements act instantaneously, performing an additional measurement right after the first results in the exact same computational basis state, as the system has had no time to evolve.  This is an example of the Zeno effect; the state of a system is frozen upon fast repeated measurements.</p>
<p>We can use this fact to drop the measurement originally included in the <code class="docutils literal notranslate"><span class="pre">reset</span></code>, and condition the x-gate on the result of the first measurement.  Because <code class="docutils literal notranslate"><span class="pre">measure</span></code>+<code class="docutils literal notranslate"><span class="pre">reset</span></code> are so ubiquitous in dynamic circuits, Qiskit can auto-simplify combinations of operations.  This is done via the <code class="docutils literal notranslate"><span class="pre">ResetAfterMeasureSimplification</span></code> transpiler pass:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pm</span> <span class="o">=</span> <span class="n">PassManager</span><span class="p">(</span><span class="n">ResetAfterMeasureSimplification</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">collapsed_qc</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">qc</span><span class="p">)</span>
<span class="n">collapsed_qc</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="s1">&#39;mpl&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/e59d44b045c4128ed0d8387394d969684355c259a45a546768bd43c1cda387b9.png" src="../../_images/e59d44b045c4128ed0d8387394d969684355c259a45a546768bd43c1cda387b9.png" />
</div>
</div>
</section>
<section id="optimized-dynamic-bv">
<h2>Optimized dynamic BV<a class="headerlink" href="#optimized-dynamic-bv" title="Permalink to this heading">#</a></h2>
<p>We are now in a position to further optimize our dynamic BV circuits by collapsing <code class="docutils literal notranslate"><span class="pre">measure</span></code>+<code class="docutils literal notranslate"><span class="pre">reset</span></code> pairs down to just a single measurement and conditional x-gate</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">collapsed_circs</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">dyn_trans_qc</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">collapsed_circs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="s1">&#39;mpl&#39;</span><span class="p">,</span> <span class="n">idle_wires</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/87823bcb4c6bd6dc7069c67b599e4e427ce5d8e1bd5ac9a0ce9a27b011c46b42.png" src="../../_images/87823bcb4c6bd6dc7069c67b599e4e427ce5d8e1bd5ac9a0ce9a27b011c46b42.png" />
</div>
</div>
<p>We can now run these circuits using <code class="docutils literal notranslate"><span class="pre">dynamic=True</span></code> (it will fail otherwise), and look to see how much the fidelity improved through this simplification.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">job3</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">collapsed_circs</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">dynamic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">collapsed_counts</span> <span class="o">=</span> <span class="n">job3</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">collapsed_fidelities</span> <span class="o">=</span> <span class="p">[</span><span class="n">hellinger_fidelity</span><span class="p">(</span><span class="n">cnts</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;1&#39;</span><span class="o">*</span><span class="p">(</span><span class="n">idx</span><span class="o">+</span><span class="mi">2</span><span class="p">):</span> <span class="mi">1</span><span class="p">})</span> 
                        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">cnts</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">collapsed_counts</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">13</span><span class="p">),</span> <span class="n">reg_fidelities</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Legacy-pipeline&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">13</span><span class="p">),</span> <span class="n">dyn_fidelities</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;QASM3-pipeline&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">13</span><span class="p">),</span> <span class="n">collapsed_fidelities</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;QASM3-collapsed&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Bits&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Fidelity&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/d70e725b17ffe856daf6b9172565d82286b5cbd780dba57731ae21b514d69968.png" src="../../_images/d70e725b17ffe856daf6b9172565d82286b5cbd780dba57731ae21b514d69968.png" />
</div>
</div>
<p>Nice!  We see that by being just a bit smarter, we have been able to greatly improve the fidelity of our dynamic BV circuits.  Because this simplification is so powerful, it is recommended to always use it when doing measurement+reset on IBM Quantum systems.</p>
</section>
<section id="openqasm-3">
<h2>OpenQASM 3<a class="headerlink" href="#openqasm-3" title="Permalink to this heading">#</a></h2>
<p>Up until now we have been using Qiskit to build quantum circuits.  This is of course the obvious thing to do, but directly building up circuits in Qiskit does have its limitations:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>1. It is difficult to programmatically build a circuit, especially dynamic ones
2. They cannot be saved in a human readable format
3. They must be made in Python
4. They are not a serialization format
5. They are limited to Qiskit itself
</pre></div>
</div>
<p>For these reasons, and others, it is beneficial to have another way to create, store, and transmit quantum circuits.</p>
<p>A completely platform-agnostic, text-based quantum circuit representation is provided by the <a class="reference external" href="https://openqasm.com/">OpenQASM specification</a>.  QASM, or quantum assembly language, has been around for almost 20 years, and OpenQASM is the primary flavor of the language.  The latest major release, version 3, brings better support for dynamic circuits and include the ability to interact with arbitrary classical code, pulse-level gate definitions, and support for explicit timing control.  QASM3 (also true for QASM2) is a Turing complete language, meaning in principle it can perform any computation, if given enough resources (memory and time).</p>
<p>QASM3 is a very convenient format for working with quantum circuits with conditional operations and creating circuits in a universal format from any language where a QASM parser exists.  That is to say that QASM3 will allow one to create circuits from any language (C/C++, Rust, Fortran, Matlab, etc…) and allow them to be executed on IBM Quantum hardware.</p>
<p>For now, lets take a look at a QASM3 representation of one of our optimized BV circuits:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">qasm3</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">collapsed_circs</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OPENQASM 3;
include &quot;stdgates.inc&quot;;
bit[3] c;
qubit[27] _all_qubits;
let q = _all_qubits[0:26];
rz(pi/2) q[8];
sx q[8];
rz(pi) q[8];
rz(pi/2) q[9];
sx q[9];
rz(-pi/2) q[9];
cx q[8], q[9];
sx q[8];
rz(pi/2) q[8];
reset q[9];
rz(pi/2) q[9];
sx q[9];
rz(-pi/2) q[9];
c[0] = measure q[8];
if (c[0] == 1) {
  x q[8];
}
rz(pi/2) q[8];
sx q[8];
rz(pi) q[8];
cx q[8], q[9];
sx q[8];
rz(pi/2) q[8];
reset q[9];
rz(pi/2) q[9];
sx q[9];
rz(-pi/2) q[9];
c[1] = measure q[8];
if (c[1] == 1) {
  x q[8];
}
rz(pi/2) q[8];
sx q[8];
rz(pi) q[8];
cx q[8], q[9];
sx q[8];
rz(pi/2) q[8];
c[2] = measure q[8];
</pre></div>
</div>
</div>
</div>
</section>
<section id="hands-on-example">
<h2>Hands-on example<a class="headerlink" href="#hands-on-example" title="Permalink to this heading">#</a></h2>
<p>Find a IBM Quantum system that supports dynamic circuits and find out how many bits you can go out to using the collapsed version of the dynamic BV circuit.  <strong>As dynamic circuits are still beta, this may fail on some systems.</strong></p>
</section>
</section>

<div class="section">
   
</div>

            </article>
            
            
            
            <footer class="bd-footer-article">
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            </footer>
            
          </div>
          
          
          
            <div class="bd-sidebar-secondary bd-toc">
              
<div class="toc-item">
  
<div class="tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
</div>
<nav id="bd-toc-nav" class="page-toc">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#background">
   Background
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#qiskit-ibm-provider">
     qiskit-ibm-provider
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dynamic-circuits">
     Dynamic circuits
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#frontmatter">
   Frontmatter
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ibm-provider-and-backend-selection">
     IBM Provider and backend selection
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dynamic-bv">
   Dynamic BV
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#measure-reset-pair-simplification">
   Measure+reset pair simplification
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#optimized-dynamic-bv">
   Optimized dynamic BV
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#openqasm-3">
   OpenQASM 3
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#hands-on-example">
   Hands-on example
  </a>
 </li>
</ul>

</nav>
</div>

<div class="toc-item">
  
<div id="searchbox"></div>
</div>

<div class="toc-item">
  
</div>

<div class="toc-item">
  
<div class="tocsection sourcelink">
    <a href="../../_sources/events/skku-2022/dynamic-circuits-2.ipynb.txt">
        <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
</div>

</div>

            </div>
          
          
        </div>
        <footer class="bd-footer-content">
          <div class="bd-footer-content__inner">
            
          </div>
        </footer>
        
      </main>
    </div>
  </div>

  
    
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94"></script>

<footer class="bd-footer">
<div>
<p xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/">
        Content on
        <a property="dct:title" rel="cc:attributionURL" href="http://quantum-enablement.org">this website</a> 
        by <span property="cc:attributionName">IBM</span> is licensed under 
        <a href="http://creativecommons.org/licenses/by-nc/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">
                Attribution-NonCommercial 4.0 International<img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1">
                <img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1">
                <img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/nc.svg?ref=chooser-v1">
        </a>
</p> 
</div>
</footer>

  </body>
</html>