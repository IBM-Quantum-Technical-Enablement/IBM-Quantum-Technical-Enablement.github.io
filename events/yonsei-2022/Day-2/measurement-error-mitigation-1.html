

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Mesurement error mitigation - I &#8212; Enabing Technologies  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/thebelab-helper.js"></script>
    <script src="../../../_static/design-tabs.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-16824831-8"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'UA-16824831-8');
            </script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'events/yonsei-2022/Day-2/measurement-error-mitigation-1';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />

  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>

<link
  rel="alternate"
  type="application/atom+xml"
  href="../../../explore/atom.xml"
  title="Quantum Explorations"
/>



  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the site..."
         aria-label="Search the site..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../../_static/dark_logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
    
  </div>
  
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../how-to/howto.html">
                        How to guides
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../explore.html">
                        Explorations
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../hardware/hardware.html">
                        IBM Hardware
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../events.html">
                        Events
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../members.html">
                        Contributors
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the site..."
         aria-label="Search the site..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/IBM-Quantum-Technical-Enablement" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../how-to/howto.html">
                        How to guides
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../explore.html">
                        Explorations
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../hardware/hardware.html">
                        IBM Hardware
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../events.html">
                        Events
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../members.html">
                        Contributors
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the site..."
         aria-label="Search the site..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/IBM-Quantum-Technical-Enablement" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumbs">
  <ul class="bd-breadcrumbs" role="navigation" aria-label="Breadcrumb">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">Mesurement error mitigation - I</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
<section class="tex2jax_ignore mathjax_ignore" id="mesurement-error-mitigation-i">
<h1>Mesurement error mitigation - I<a class="headerlink" href="#mesurement-error-mitigation-i" title="Permalink to this heading">#</a></h1>
<div class="alert alert-warning">
    This notebook is requires installing the following:
    <ul>
        <li>M3: <tt>pip install mthree</tt></li>
    </ul>
</div><section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">#</a></h2>
<p>On superconducting platforms such as IBM Quantum systems, measurements have one of the highest (it not the highest) error rate per operation of any instruction.  Although quantum circuits often contain many more gates than measurements, the output of a quantum computer relies on qubit measurement, making the correction of these operations an important task for achieving high-fidelity results.  Fortunately, techniques have been developed that make mitigating these errors, on average, computationally feasible.  However, as with all mitigation methods, the cost is an increase in the variance of the computed observables; requiring an increase in the number of circuit executions needed for recovering the initial variance.  Here we will see how to use the “M3” method to correct measurement errors in experiments requiring expectation values.  the correction of probability distributions is also addressed.</p>
<ul class="simple">
<li><p>M3 Paper: <a class="reference external" href="https://doi.org/10.1103/PRXQuantum.2.040326">PRX Quantum 2, 040326 (2021)</a></p></li>
</ul>
</section>
<section id="frontmatter">
<h2>Frontmatter<a class="headerlink" href="#frontmatter" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Standard imports</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">qiskit</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># Load stuff needed for this notebook</span>
<span class="kn">from</span> <span class="nn">qiskit.quantum_info</span> <span class="kn">import</span> <span class="n">Statevector</span><span class="p">,</span> <span class="n">hellinger_fidelity</span>
<span class="kn">from</span> <span class="nn">qiskit.providers.fake_provider</span> <span class="kn">import</span> <span class="n">FakeProvider</span>
<span class="kn">from</span> <span class="nn">qiskit.result</span> <span class="kn">import</span> <span class="n">sampled_expectation_value</span>

<span class="c1"># Load the M3 measurement mitigation tools</span>
<span class="kn">import</span> <span class="nn">mthree</span>

<span class="c1"># Plotting stuff to look better</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">config</span> InlineBackend.figure_format = &#39;retina&#39;
<span class="k">try</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;quantum-light&#39;</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
</pre></div>
</div>
</div>
</div>
<p>Lets load our IBM account and grab a real system:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">IBMQ</span><span class="o">.</span><span class="n">load_account</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AccountProvider for IBMQ(hub=&#39;ibm-q&#39;, group=&#39;open&#39;, project=&#39;main&#39;)&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">provider</span> <span class="o">=</span> <span class="n">IBMQ</span><span class="o">.</span><span class="n">get_provider</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="s1">&#39;internal-test&#39;</span><span class="p">)</span>
<span class="n">real_backend</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="n">get_backend</span><span class="p">(</span><span class="s1">&#39;ibm_sherbrooke&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this heading">#</a></h2>
<p>Although the power of quantum computation lies in the ability to create large amounts of entanglement and explore large swaths of Hilbert space, at the end of the day the result encoded in the terminal quantum state must be converted to classical information by measuring the qubits.  Note that there is also the possibility of mid-circuit measurements, but we will not address those here.</p>
<p>When measureing a qubit, there are two error rates that quantify the noise:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(P_{10}\)</span>: Probability of qubit in the <span class="math notranslate nohighlight">\(0\)</span> state but measuring <span class="math notranslate nohighlight">\(1\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(P_{01}\)</span>: Probability of qubit in the <span class="math notranslate nohighlight">\(1\)</span> state but measuring <span class="math notranslate nohighlight">\(0\)</span>.</p></li>
</ul>
<p>The probabilities of correctly measuring the qubit in the 0 and 1 states are thus <span class="math notranslate nohighlight">\(P_{00}=1-P_{10}\)</span> and <span class="math notranslate nohighlight">\(P_{11}=1-P_{01}\)</span>, respectively.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">provider</span> <span class="o">=</span> <span class="n">FakeProvider</span><span class="p">()</span>
<span class="n">backend</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="n">get_backend</span><span class="p">(</span><span class="s1">&#39;fake_hanoi&#39;</span><span class="p">)</span>
<span class="n">props</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">properties</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">P01</span> <span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">qubit_property</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;prob_meas0_prep1&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">P10</span> <span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">qubit_property</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;prob_meas1_prep0&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Assuming the measurement error for each qubit is uncorrelated with that of other qubits, we can define an Assignment, “A-matrix”, for each qubit:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Build the &quot;Assignment&quot; matrix</span>
<span class="n">A0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="o">-</span><span class="n">P10</span><span class="p">,</span> <span class="n">P01</span><span class="p">],</span>
               <span class="p">[</span><span class="n">P10</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">P01</span><span class="p">]])</span>
<span class="n">A0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0.9934, 0.01  ],
       [0.0066, 0.99  ]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>

<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">A0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># Coordinates for annotations are (x,y) NOT matrix (row, col)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;$P_</span><span class="si">{00}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;$P_</span><span class="si">{11}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;$P_</span><span class="si">{01}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;$P_</span><span class="si">{10}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s1">&#39;$|0</span><span class="se">\\</span><span class="s1">rangle_{</span><span class="se">\\</span><span class="s1">rm in}$&#39;</span><span class="p">,</span> <span class="s1">&#39;$|1</span><span class="se">\\</span><span class="s1">rangle_{</span><span class="se">\\</span><span class="s1">rm in}$&#39;</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="s1">&#39;$|0</span><span class="se">\\</span><span class="s1">rangle_{</span><span class="se">\\</span><span class="s1">rm out}$&#39;</span><span class="p">,</span> <span class="s1">&#39;$|1</span><span class="se">\\</span><span class="s1">rangle_{</span><span class="se">\\</span><span class="s1">rm out}$&#39;</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/2b95de9882b2a573cb47d8307177562d3824aa50ad2289cbb3e39b866349441d.png" src="../../../_images/2b95de9882b2a573cb47d8307177562d3824aa50ad2289cbb3e39b866349441d.png" />
</div>
</div>
<p>The interpretation of the A-matrix is as follows.  The column indices label the target bit-string state, while the row indicates what you actually got in your experiment.  Thus we see that the matrix elements <span class="math notranslate nohighlight">\(P_{ij}\)</span> tell us the probability of starting in state <span class="math notranslate nohighlight">\(j\)</span>, but ending up in state <span class="math notranslate nohighlight">\(i\)</span>.  Typically <span class="math notranslate nohighlight">\(P_{01} &gt; P_{10}\)</span> because relaxation of the <span class="math notranslate nohighlight">\(|1\rangle\)</span> state to the <span class="math notranslate nohighlight">\(|0\rangle\)</span> is the dominante source of error. Notice that the sum over all the elements of each column is <code class="docutils literal notranslate"><span class="pre">1</span></code>; an input bit-string has to go somehwere.</p>
<p>The average of the two error rates, <span class="math notranslate nohighlight">\(P_{01}\)</span> and <span class="math notranslate nohighlight">\(P_{10}\)</span>, is called the <code class="docutils literal notranslate"><span class="pre">readout_error</span></code> and it is also reported by the backend for each qubit:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">props</span><span class="o">.</span><span class="n">qubit_property</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;readout_error&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(0.008299999999999974,
 datetime.datetime(2021, 12, 9, 0, 30, 10, tzinfo=tzoffset(None, -18000)))
</pre></div>
</div>
</div>
</div>
<p>Lets take a look at the distribution of these values over a full system:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">meas_errors</span> <span class="o">=</span> <span class="p">[</span><span class="n">props</span><span class="o">.</span><span class="n">qubit_property</span><span class="p">(</span><span class="n">qubit</span><span class="p">,</span> <span class="s1">&#39;readout_error&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> 
               <span class="k">for</span> <span class="n">qubit</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">backend</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span><span class="o">.</span><span class="n">num_qubits</span><span class="p">)]</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Median:&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">meas_errors</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">meas_errors</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Median: 0.013399999999999967
Mean: 0.01886666666666666
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">meas_errors</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">27</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Error rate&#39;</span><span class="p">);</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Counts&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/80b3a411679ae584721c1a6c8fdef7b54202a1d0e569298ed6f34366441784c1.png" src="../../../_images/80b3a411679ae584721c1a6c8fdef7b54202a1d0e569298ed6f34366441784c1.png" />
</div>
</div>
<p>We see that the error rates can vary by and order of magnitude over a quantum chip.  Therefore qubit selection and ultimately readout mitigation is needed to reduce the impact of measurement imperfections.  How to do this is the topic of the next section.</p>
</section>
<section id="mitigating-measurement-errors">
<h2>Mitigating measurement errors<a class="headerlink" href="#mitigating-measurement-errors" title="Permalink to this heading">#</a></h2>
<p>The A-matrix leads us to a very simple linear expression for how measurement errors affect our output probability distribution:</p>
<div class="math notranslate nohighlight">
\[
\vec{p}_{\rm exp} = A\vec{p}_{\rm ideal}
\]</div>
<p>where <span class="math notranslate nohighlight">\(\vec{p}_{\rm ideal}\)</span> is a vector representation of the ideal distribution (including gate errors) over all computational basis states, and <span class="math notranslate nohighlight">\(\vec{p}_{\rm exp}\)</span> is the actual distribution we measured in the experiment.  This equation is valid for not just a single qubit, but any number of measured qubits, but the dimensionality of the full linear system of equations grows exponentially in the number of qubits.  Assuming readout out errors are independent, the full A-matrix takes the form:  <span class="math notranslate nohighlight">\(A=A_{n-1}\otimes\dots\otimes A_{1}\otimes A_{0}\)</span></p>
<p>The equation above is a linear equation of the form <span class="math notranslate nohighlight">\(A\vec{x}=\vec{b}\)</span>, where we are solving for the unknown vector <span class="math notranslate nohighlight">\(\vec{x}=\vec{p}_{\rm ideal}\)</span>.  Let try solving it for a very simple example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">measure_all</span><span class="p">()</span>

<span class="c1"># Here we are using &quot;seed_simulator&quot; to fix the output</span>
<span class="n">counts</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="mf">1e4</span><span class="p">,</span> <span class="n">seed_simulator</span><span class="o">=</span><span class="mi">12345</span><span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()</span>
<span class="n">counts</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;0&#39;: 96, &#39;1&#39;: 9904}
</pre></div>
</div>
</div>
</div>
<p>Because the A-matrix deals with probabilities, we need to convert the sampled statistics returned by the processor into probabilities:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">counts_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">counts_vec</span> <span class="o">/=</span> <span class="mf">1e4</span>
<span class="n">counts_vec</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.0096, 0.9904])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A0</span><span class="p">,</span> <span class="n">counts_vec</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([-4.06752085e-04,  1.00040675e+00])
</pre></div>
</div>
</div>
</div>
<p>After running the above code you should see that the probability of getting <code class="docutils literal notranslate"><span class="pre">'1'</span></code> is nearly 1.0.  In fact it can be even larger than 1, with a negative probability for being found in the <code class="docutils literal notranslate"><span class="pre">'0'</span></code> state!  This is not an error or bug, but rather a consequence of the fact that there are fluctuations in sampling statistics that can lead to over- or under-correction.  The output from measurement mitigation is a wider class of distibutions known as quasi-probability distributions; Distributions that can contain negative values, but never the less sum up to one.  This fact raises an important limitation on what we can do with these distributions; <strong>Quasi-probability distributions can only be directly used to compute expectation values of observables or finding the most probable bit-string</strong>.  They cannot be used, for example, for computing the fidelity of the result against a known answer.</p>
</section>
<section id="measurement-mitigation-with-m3">
<h2>Measurement mitigation with M3<a class="headerlink" href="#measurement-mitigation-with-m3" title="Permalink to this heading">#</a></h2>
<p>Given the realatively high error rates of measurements on superconducting processors, we would like to suppress these errors as much as possible.  Now, we could naively find the A-matrix corresponding to each measured qubit and take the tensor product of them all.  However, this leads to a <span class="math notranslate nohighlight">\(2^{N}\times 2^{N}\)</span> matrix that is tractible for only a small number of qubits, e.g. <span class="math notranslate nohighlight">\(\lesssim 18\)</span>.  In order to correct large numbers of qubits we need to be a bit smarter than this.</p>
<p>The M3 (<strong>M</strong>atrix-free <strong>M</strong>easurement <strong>Mitigation</strong>) is one example that looks at the problem in a different way.</p>
<p><img alt="M3" src="../../../_images/m3_truncation.png" /></p>
<p>Namely, M3 considers the fact that, when measurement errors are small, the effect is to take small amounts of probability away from the correct output bit-strings and move them to erroneous bit-strings that are close in terms of Hamming distance.  Because the errors are weak, with sufficient sampling, it is unlikely that an ideal bit-string is completely redistributed; the correct answer is a subset of the noisy output.  This insight indicates that we can truncate the full A-matrix into one that has a dimension that is equal to the number of unique bit-strings in the output.  This equation is typically much much smaller than the full A-matrix, and thus easier to solve, e.g. via LU decomposition or iterative methods.</p>
<p>M3 measurement mitigation can be broken into 3 steps:</p>
<ol class="arabic simple">
<li><p>Construct a mitigator targeting a backend (<code class="docutils literal notranslate"><span class="pre">backend</span></code>).</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mthree</span>
<span class="n">mit</span> <span class="o">=</span> <span class="n">mthree</span><span class="o">.</span><span class="n">M3Mitigation</span><span class="p">(</span><span class="n">backend</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Use the mitigator <code class="docutils literal notranslate"><span class="pre">mit</span></code> to calibrate over a list of physical qubits (<code class="docutils literal notranslate"><span class="pre">qubits</span></code>) measured</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mit</span><span class="o">.</span><span class="n">cals_from_system</span><span class="p">(</span><span class="n">qubits</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Generate a corrected set of quasiprobabilities from a given set of noisy counts data <code class="docutils literal notranslate"><span class="pre">raw_counts</span></code>:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">quasi_probs</span> <span class="o">=</span> <span class="n">mit</span><span class="o">.</span><span class="n">apply_correction</span><span class="p">(</span><span class="n">raw_counts</span><span class="p">,</span> <span class="n">qubits</span><span class="p">)</span>
</pre></div>
</div>
<p>We can then use these quasiprobabilities to compute any diagonal expectation values that we like.  This can be done in M3, but can also be done in Qiskit 0.22+ using the <code class="docutils literal notranslate"><span class="pre">sampled_expectation_value</span></code> function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qiskit.result</span> <span class="kn">import</span> <span class="n">sampled_expectation_value</span>

<span class="n">mitigated_result</span> <span class="o">=</span> <span class="n">sampled_expectation_value</span><span class="p">(</span><span class="n">quasi_probs</span><span class="p">,</span> <span class="n">observable</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this heading">#</a></h2>
<section id="setup">
<h3>Setup<a class="headerlink" href="#setup" title="Permalink to this heading">#</a></h3>
<p>To begin, let us consider the following “controlled-Hadamard ladder” circuit:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>

<span class="n">qc</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
<span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>

<span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">ch</span><span class="p">(</span><span class="n">kk</span><span class="p">,</span> <span class="n">kk</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">ch</span><span class="p">(</span><span class="n">kk</span><span class="p">,</span> <span class="n">kk</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="s1">&#39;mpl&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/1557761b3724853bc3b93cfebe5a78718637513fc02f324e6601088948caebd5.png" src="../../../_images/1557761b3724853bc3b93cfebe5a78718637513fc02f324e6601088948caebd5.png" />
</div>
</div>
<p>This circuit is interesting in that it has a non-trivial output distribution and expectation value.  Because the circuit is small, we can directly compute the statevector from this circuit and grab the ideal probability distribution:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate output statevector assuming initial state was ground state</span>
<span class="n">state_vec</span> <span class="o">=</span> <span class="n">Statevector</span><span class="o">.</span><span class="n">from_instruction</span><span class="p">(</span><span class="n">qc</span><span class="p">)</span>
<span class="c1"># Generate ideal distribution from state vector (infinite sampling limit)</span>
<span class="n">ideal_probs</span> <span class="o">=</span> <span class="n">state_vec</span><span class="o">.</span><span class="n">probabilities_dict</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Given the ideal distribution we can compute the expectation value for any diagonal operator that we like, e.g. <code class="docutils literal notranslate"><span class="pre">ZZZZZZ</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sampled_expectation_value</span><span class="p">(</span><span class="n">ideal_probs</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="o">*</span><span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.4374999999999999
</pre></div>
</div>
</div>
</div>
</section>
<section id="execution">
<h3>Execution<a class="headerlink" href="#execution" title="Permalink to this heading">#</a></h3>
<p>Let us now transpile the circuit and get the noisy output distribution</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># First add some measurements to the circuit</span>
<span class="n">qc_with_meas</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">measure_all</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># transpile circuits with measurements</span>
<span class="n">trans_qc</span> <span class="o">=</span> <span class="n">transpile</span><span class="p">(</span><span class="n">qc_with_meas</span><span class="p">,</span> <span class="n">backend</span><span class="p">,</span> <span class="n">optimization_level</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">noisy_counts</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">trans_qc</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="mf">1e4</span><span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Now let us compute the noisy expectation value :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sampled_expectation_value</span><span class="p">(</span><span class="n">noisy_counts</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="o">*</span><span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.3428
</pre></div>
</div>
</div>
</div>
<p>So we get something a bit lower than the target <code class="docutils literal notranslate"><span class="pre">0.4375</span></code>.</p>
</section>
<section id="mitigation-with-m3">
<h3>Mitigation with M3<a class="headerlink" href="#mitigation-with-m3" title="Permalink to this heading">#</a></h3>
<p>Let us now follow our 3-step recipe for using M3.</p>
<p>First we contruct our mitigator object:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mit</span> <span class="o">=</span> <span class="n">mthree</span><span class="o">.</span><span class="n">M3Mitigation</span><span class="p">(</span><span class="n">backend</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We now need to calibrate the mitigator for the physical qubits that we measure at the end of the circuit.  But our circuit has been transpiled; the physical qubit indices need not match the virtual qubit indices in the circuit.  How do we determine which qubits are being measured?</p>
<p>We could look at the circuit:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># idle_wires=False shows only active qubits in the circuit</span>
<span class="n">trans_qc</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="s1">&#39;mpl&#39;</span><span class="p">,</span> <span class="n">idle_wires</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/491b00de88f5a3953bc6c9820e876bc380755dd06bc8225a5242a32401ee0053.png" src="../../../_images/491b00de88f5a3953bc6c9820e876bc380755dd06bc8225a5242a32401ee0053.png" />
</div>
</div>
<p>From the circuit drawing we see that circuit qubits 0-&gt;5 are mapped to physical qubits <code class="docutils literal notranslate"><span class="pre">[14,16,19,22,25,26]</span></code>.  These are the qubits we need to calibrate.</p>
<p>We can also find this set programmatically via M3:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mapping</span> <span class="o">=</span> <span class="n">mthree</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">final_measurement_mapping</span><span class="p">(</span><span class="n">trans_qc</span><span class="p">)</span>
<span class="n">mapping</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{14: 0, 16: 1, 19: 2, 22: 3, 25: 4, 26: 5}
</pre></div>
</div>
</div>
</div>
<p>This “mapping” contains the same information, and allows us to easily determine which qubits are being used.  Let us now calibrate the mitigator <code class="docutils literal notranslate"><span class="pre">mit</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mit</span><span class="o">.</span><span class="n">cals_from_system</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span> <span class="c1"># We can directly pass the computed mapping or the list</span>
</pre></div>
</div>
</div>
</div>
<p>We can view the individual A-matrices that are generated from the calibrations, and see that we did indeed calibrate the correct physical qubits:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mit</span><span class="o">.</span><span class="n">single_qubit_cals</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[None,
 None,
 None,
 None,
 None,
 None,
 None,
 None,
 None,
 None,
 None,
 None,
 None,
 None,
 array([[0.9934, 0.012 ],
        [0.0066, 0.988 ]]),
 None,
 array([[0.9836, 0.0152],
        [0.0164, 0.9848]]),
 None,
 None,
 array([[0.9951, 0.0092],
        [0.0049, 0.9908]]),
 None,
 None,
 array([[0.9937, 0.0172],
        [0.0063, 0.9828]]),
 None,
 None,
 array([[0.9848, 0.023 ],
        [0.0152, 0.977 ]]),
 array([[0.9935, 0.0072],
        [0.0065, 0.9928]])]
</pre></div>
</div>
</div>
</div>
<p>We are now in a position to perform the actual mitigation and compute the mitigated expectation value:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quasi</span> <span class="o">=</span> <span class="n">mit</span><span class="o">.</span><span class="n">apply_correction</span><span class="p">(</span><span class="n">noisy_counts</span><span class="p">,</span> <span class="n">mapping</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sampled_expectation_value</span><span class="p">(</span><span class="n">quasi</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="o">*</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.40678438959898355
</pre></div>
</div>
</div>
</div>
<p>We see that the mitigated value is much closer to the ideal answer <code class="docutils literal notranslate"><span class="pre">0.4375</span></code>.  Indeed, the error that remains is primarily due to gate errors that require additional mitigation techniques to suppress.</p>
</section>
</section>
<section id="mitigated-observable-uncertainties">
<h2>Mitigated observable uncertainties<a class="headerlink" href="#mitigated-observable-uncertainties" title="Permalink to this heading">#</a></h2>
<p>While measurement mitigation improves the accuracy of expectation values, this comes at the cost of an increase variance (loss of precision) in the final output.  This is because mitigating measurement errors add uncertainty on top of the uncertainty already present in the ideal distribution.</p>
<p>Without mitigation, an upper bound for the variance of an expectation value with absolute value <span class="math notranslate nohighlight">\(\leq 1\)</span> is given by <span class="math notranslate nohighlight">\(1/\rm shots\)</span>, or equivilently for the standard deviation <span class="math notranslate nohighlight">\(1/\sqrt{\rm shots}\)</span>.</p>
<p>The increase in variance from mitigation is called the <code class="docutils literal notranslate"><span class="pre">mitigation_overhead</span></code> (<span class="math notranslate nohighlight">\(\Gamma\)</span>) in M3.  This feeds into the upper-bound for the variance (standard deviation) as <span class="math notranslate nohighlight">\(\Gamma/\rm shots\)</span> (<span class="math notranslate nohighlight">\(\sqrt{\Gamma/\rm shots}\)</span>)</p>
<p>M3 does not compute this value by default as it inccurs additional overhead.  To compute this value we need to pass <code class="docutils literal notranslate"><span class="pre">return_mitigation_overhead=True</span></code> when we compute the correction:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quasi_with_error</span> <span class="o">=</span> <span class="n">mit</span><span class="o">.</span><span class="n">apply_correction</span><span class="p">(</span><span class="n">noisy_counts</span><span class="p">,</span> <span class="n">mapping</span><span class="p">,</span> 
                                        <span class="n">return_mitigation_overhead</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The resulting mitigation overhead is now an attribute of the returned quasi-distribution:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quasi_with_error</span><span class="o">.</span><span class="n">mitigation_overhead</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.4005884526744052
</pre></div>
</div>
</div>
</div>
<p>This is telling us that, in order to get the same upper bound on the variance as the unmitigated case, we need to do <span class="math notranslate nohighlight">\(\Gamma\)</span> times more shots.  If for example, we wanted to compute the standard deviation for this result (at 1e4 shots) we could do:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">quasi_with_error</span><span class="o">.</span><span class="n">mitigation_overhead</span> <span class="o">/</span> <span class="mf">1e4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.01183464597136055
</pre></div>
</div>
</div>
</div>
<p>Or take advantage of the fact that M3 will compute this for you:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quasi_with_error</span><span class="o">.</span><span class="n">stddev</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.01183464597136055
</pre></div>
</div>
</div>
</div>
<p>Or, even better we can get the expectation value and standard deviation in a single call:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quasi_with_error</span><span class="o">.</span><span class="n">expval_and_stddev</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="o">*</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(0.40678438959898355, 0.01183464597136055)
</pre></div>
</div>
</div>
</div>
<p>Note that the mitigation overhead scales exponentially in the number of qubits.  The base of this exponential is determined by the circuit and quality of the device on which the circuit(s) is run; An ideal system has <span class="math notranslate nohighlight">\(\Gamma=1\)</span>.</p>
<section id="mitigating-sampling-problems">
<h3>Mitigating sampling problems<a class="headerlink" href="#mitigating-sampling-problems" title="Permalink to this heading">#</a></h3>
<p>Up until now we have focused on mitigating expectation values, as many near-term applications return expectation values.  However, it is also possible to mitigate sampling problems such as BV, Grovers, etc.. where one is interested in finding the most probable bit-string.  Consider the BV circuit for all-ones bitstrings:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">bv_ones_circs</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">barrier</span><span class="p">()</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">qc</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">bv_circ</span> <span class="o">=</span> <span class="n">bv_ones_circs</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">bv_circ</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="s1">&#39;mpl&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/0be922c17ea19fc0da4468fbc8984d32bd43f693eabf5f07595c494436bfefd1.png" src="../../../_images/0be922c17ea19fc0da4468fbc8984d32bd43f693eabf5f07595c494436bfefd1.png" />
</div>
</div>
<p>We can ask ourselves what is the most-probable bit-string as a function of the number of qubits <code class="docutils literal notranslate"><span class="pre">N</span></code> in the circuit.  Ideally this should be <code class="docutils literal notranslate"><span class="pre">'1'*(N-1)</span></code>.  Lets see if this is true, and if we can improve the probability of success.</p>
<p>First we generate a collection of circuits for different <code class="docutils literal notranslate"><span class="pre">N</span></code> values:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bv_circs</span> <span class="o">=</span> <span class="p">[</span><span class="n">bv_ones_circs</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="k">for</span> <span class="n">N</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">13</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<p>We of course have to map them to the target system:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">trans_bv_circs</span> <span class="o">=</span> <span class="n">transpile</span><span class="p">(</span><span class="n">bv_circs</span><span class="p">,</span> <span class="n">backend</span><span class="p">,</span> <span class="n">optimization_level</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now let us run them all on our noisy simulator:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">raw_bv_counts</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">trans_bv_circs</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">1e4</span><span class="p">))</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>To compute the most likely bit-string and the associated probability we make a little function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">most_likely_bitstring</span><span class="p">(</span><span class="n">dist</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the most likely bit-string from a distribution</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        dist (dict_like): Input distribution</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        str: Most likely bit-string</span>
<span class="sd">        float: Bit-string probability</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">shots</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">dist</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="n">max_bitstring</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">max_prob</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dist</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">value</span> <span class="o">/</span> <span class="n">shots</span>
        <span class="k">if</span> <span class="n">temp</span> <span class="o">&gt;</span> <span class="n">max_prob</span><span class="p">:</span>
            <span class="n">max_prob</span> <span class="o">=</span> <span class="n">temp</span>
            <span class="n">max_bitstring</span> <span class="o">=</span> <span class="n">key</span>
    <span class="k">return</span> <span class="n">max_bitstring</span><span class="p">,</span> <span class="n">max_prob</span>
</pre></div>
</div>
</div>
</div>
<p>and compute the results on our raw data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">most_likely_bitstring</span><span class="p">(</span><span class="n">cnts</span><span class="p">)</span> <span class="k">for</span> <span class="n">cnts</span> <span class="ow">in</span> <span class="n">raw_bv_counts</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;1&#39;, 0.9881),
 (&#39;11&#39;, 0.9632),
 (&#39;111&#39;, 0.9485),
 (&#39;1111&#39;, 0.9106),
 (&#39;11111&#39;, 0.8158),
 (&#39;111111&#39;, 0.8447),
 (&#39;1111111&#39;, 0.7188),
 (&#39;11111111&#39;, 0.7008),
 (&#39;111111111&#39;, 0.6094),
 (&#39;1111111111&#39;, 0.5533),
 (&#39;11111111111&#39;, 0.6864)]
</pre></div>
</div>
</div>
</div>
<p>Now, we can proceed like we did before by building a M3 mitigator, finding the physical qubits used, calibrating those qubits, and applying the correction.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mit</span> <span class="o">=</span> <span class="n">mthree</span><span class="o">.</span><span class="n">M3Mitigation</span><span class="p">(</span><span class="n">backend</span><span class="p">)</span>
<span class="n">mappings</span> <span class="o">=</span> <span class="n">mthree</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">final_measurement_mapping</span><span class="p">(</span><span class="n">trans_bv_circs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now, we need to be a bit careful here because the total number of unique qubits in the mapping can be large as the Qiskit transpiler tries to move the circuit around on the physical qubits to supress errors:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">mappings</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[dict_keys([1]),
 dict_keys([0, 4]),
 dict_keys([4, 0, 2]),
 dict_keys([7, 2, 4, 0]),
 dict_keys([25, 22, 14, 13, 8]),
 dict_keys([3, 0, 2, 4, 1, 6]),
 dict_keys([22, 19, 9, 8, 11, 16, 13]),
 dict_keys([20, 22, 13, 8, 14, 11, 16, 10]),
 dict_keys([13, 20, 22, 8, 14, 19, 16, 11, 10]),
 dict_keys([22, 20, 10, 12, 19, 16, 9, 14, 13, 8]),
 dict_keys([25, 20, 19, 22, 16, 8, 11, 14, 7, 10, 13])]
</pre></div>
</div>
</div>
</div>
<p>Because noisy simulations over many qubits is difficult, here we change the method for easier simulation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mit</span><span class="o">.</span><span class="n">cals_from_system</span><span class="p">(</span><span class="n">mappings</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;independent&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We apply the correction and recompute the most likely bit-strings and probabilities:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quasis</span> <span class="o">=</span> <span class="n">mit</span><span class="o">.</span><span class="n">apply_correction</span><span class="p">(</span><span class="n">raw_bv_counts</span><span class="p">,</span> <span class="n">mappings</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">most_likely_bitstring</span><span class="p">(</span><span class="n">cnts</span><span class="p">)</span> <span class="k">for</span> <span class="n">cnts</span> <span class="ow">in</span> <span class="n">quasis</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;1&#39;, 0.9965401444998474),
 (&#39;11&#39;, 0.9851359319635592),
 (&#39;111&#39;, 0.9867708059034757),
 (&#39;1111&#39;, 0.9645667763352116),
 (&#39;11111&#39;, 0.8947715665347649),
 (&#39;111111&#39;, 0.9134275936499842),
 (&#39;1111111&#39;, 0.8188130485044268),
 (&#39;11111111&#39;, 0.8307768154945566),
 (&#39;111111111&#39;, 0.7286470895401345),
 (&#39;1111111111&#39;, 0.7348082900639324),
 (&#39;11111111111&#39;, 0.8530190370847195)]
</pre></div>
</div>
</div>
</div>
<p>We see a very large improvement in the overall probability of the ideal bit-string.</p>
</section>
</section>
<section id="hands-on-exercise">
<h2>Hands-on exercise<a class="headerlink" href="#hands-on-exercise" title="Permalink to this heading">#</a></h2>
<p>Papers on readout error mitigation usually look at mitigation applied to the output of GHZ states <span class="math notranslate nohighlight">\(|\psi\rangle = |0^{\otimes N}\rangle + |1^{\otimes N}\rangle\)</span> for even <code class="docutils literal notranslate"><span class="pre">N</span></code> as the expectation value is equal to <code class="docutils literal notranslate"><span class="pre">1.0</span></code>.</p>
<p>Try to build as large a GHZ state as possible, largest <span class="math notranslate nohighlight">\(N\)</span>, such that the expectation value is <span class="math notranslate nohighlight">\( &gt;=0.5\)</span> after applying M3.  Make a plot of the expectation value for increasing <span class="math notranslate nohighlight">\(N\)</span>, before and after mitigation, making sure to plot twice the mitigated standard deviation as well.  Feel free to try one of the GHZ circuit generators below.</p>
<p>The Matplotlib <code class="docutils literal notranslate"><span class="pre">errorbar</span></code> function will help you plot the error bars easily.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">dense_ghz</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a GHZ state using the same qubit as the control.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        N (int): The number of qubits</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        QuantumCircuit: Circuit for GHZ state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">measure_all</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">qc</span>


<span class="k">def</span> <span class="nf">linear_ghz</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a GHZ state using a ladder of CX gates.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        N (int): The number of qubits</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        QuantumCircuit: Circuit for GHZ state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">measure_all</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">qc</span>


<span class="k">def</span> <span class="nf">parallel_ghz</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a GHZ state using parallel CX gates.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        N (int): The number of qubits</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        QuantumCircuit: Circuit for GHZ state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">N</span><span class="o">//</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">//</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">N</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">//</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">measure_all</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">qc</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">qubit_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

<span class="n">ghz_circs</span> <span class="o">=</span> <span class="p">[</span><span class="n">parallel_ghz</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="k">for</span> <span class="n">N</span> <span class="ow">in</span> <span class="n">qubit_range</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">trans_ghz_circs</span> <span class="o">=</span> <span class="n">transpile</span><span class="p">(</span><span class="n">ghz_circs</span><span class="p">,</span> <span class="n">real_backend</span><span class="p">,</span> <span class="n">optimization_level</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">raw_counts</span> <span class="o">=</span> <span class="n">real_backend</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">trans_ghz_circs</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">1e4</span><span class="p">))</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mit</span> <span class="o">=</span> <span class="n">mthree</span><span class="o">.</span><span class="n">M3Mitigation</span><span class="p">(</span><span class="n">real_backend</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mappings</span> <span class="o">=</span> <span class="n">mthree</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">final_measurement_mapping</span><span class="p">(</span><span class="n">trans_ghz_circs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mit</span><span class="o">.</span><span class="n">cals_from_system</span><span class="p">(</span><span class="n">mappings</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quasi_dists</span> <span class="o">=</span> <span class="n">mit</span><span class="o">.</span><span class="n">apply_correction</span><span class="p">(</span><span class="n">raw_counts</span><span class="p">,</span> <span class="n">mappings</span><span class="p">,</span>
                                   <span class="n">return_mitigation_overhead</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">expvals_stddevs</span> <span class="o">=</span> <span class="n">quasi_dists</span><span class="o">.</span><span class="n">expval_and_stddev</span><span class="p">([</span><span class="s1">&#39;Z&#39;</span><span class="o">*</span><span class="n">N</span> <span class="k">for</span> <span class="n">N</span> <span class="ow">in</span> <span class="n">qubit_range</span><span class="p">])</span>

<span class="n">mit_expvals</span> <span class="o">=</span> <span class="p">[</span><span class="n">term</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">expvals_stddevs</span><span class="p">]</span>
<span class="n">mit_stddev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">term</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">expvals_stddevs</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">raw_expvals</span> <span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">num_qubits</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">qubit_range</span><span class="p">):</span>
    <span class="n">raw_expvals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sampled_expectation_value</span><span class="p">(</span><span class="n">raw_counts</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="s1">&#39;Z&#39;</span><span class="o">*</span><span class="n">num_qubits</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">raw_stddev</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1e4</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">raw_expvals</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>

<span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">qubit_range</span><span class="p">,</span> <span class="n">mit_expvals</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">mit_stddev</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mitigated&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">qubit_range</span><span class="p">,</span> <span class="n">raw_expvals</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">raw_stddev</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Raw&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/e2d259a7d74e3762126dad3454aaa3eafd53e72fee3744b083bbfd10de8c1613.png" src="../../../_images/e2d259a7d74e3762126dad3454aaa3eafd53e72fee3744b083bbfd10de8c1613.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">qiskit.tools.jupyter</span>
<span class="o">%</span><span class="k">qiskit_version_table</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><h3>Version Information</h3><table><tr><th>Qiskit Software</th><th>Version</th></tr><tr><td><code>qiskit-terra</code></td><td>0.22.3</td></tr><tr><td><code>qiskit-aer</code></td><td>0.11.2</td></tr><tr><td><code>qiskit-ibmq-provider</code></td><td>0.19.2</td></tr><tr><td><code>qiskit</code></td><td>0.39.4</td></tr><tr><th>System information</th></tr><tr><td>Python version</td><td>3.10.8</td></tr><tr><td>Python compiler</td><td>Clang 14.0.6 </td></tr><tr><td>Python build</td><td>main, Nov 22 2022 08:25:29</td></tr><tr><td>OS</td><td>Darwin</td></tr><tr><td>CPUs</td><td>8</td></tr><tr><td>Memory (Gb)</td><td>16.0</td></tr><tr><td colspan='2'>Sat Dec 10 06:55:15 2022 EST</td></tr></table></div></div>
</div>
</section>
</section>

<div class="section ablog__blog_comments">
  
  
</div>

                </article>
              
              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#frontmatter">Frontmatter</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">Background</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mitigating-measurement-errors">Mitigating measurement errors</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#measurement-mitigation-with-m3">Measurement mitigation with M3</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example">Example</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setup">Setup</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#execution">Execution</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mitigation-with-m3">Mitigation with M3</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mitigated-observable-uncertainties">Mitigated observable uncertainties</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mitigating-sampling-problems">Mitigating sampling problems</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#hands-on-exercise">Hands-on exercise</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div class="tocsection sourcelink">
    <a href="../../../_sources/events/yonsei-2022/Day-2/measurement-error-mitigation-1.ipynb.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

<footer class="bd-footer">
<div>
<p xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/">
        Content on
        <a property="dct:title" rel="cc:attributionURL" href="http://quantum-enablement.org">this website</a> 
        by <span property="cc:attributionName">IBM</span> is licensed under 
        <a href="http://creativecommons.org/licenses/by-nc/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">
                Attribution-NonCommercial 4.0 International<img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1">
                <img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1">
                <img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/nc.svg?ref=chooser-v1">
        </a>
</p> 
</div>
</footer>

  </body>
</html>