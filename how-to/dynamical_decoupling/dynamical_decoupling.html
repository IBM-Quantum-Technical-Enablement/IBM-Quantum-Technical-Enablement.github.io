
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Dynamical Decoupling &#8212; Enabing Technologies  documentation</title>
<script>
  document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
  document.documentElement.dataset.theme = localStorage.getItem("theme") || "light"
</script>

  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=92025949c220c2e29695" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=92025949c220c2e29695" rel="stylesheet">


  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />

  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/thebelab-helper.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <script async="async" src="https://www.google-analytics.com/analytics.js"></script>
    <script>
                window.ga = window.ga || function () {
                    (ga.q = ga.q || []).push(arguments) };
                ga.l = +new Date;
                ga('create', 'UA-16824831-8', 'auto');
                ga('set', 'anonymizeIp', true);
                ga('send', 'pageview');
            </script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Mesurement error mitigation using M3" href="../mitigation/M3/m3_mitigation.html" />
    <link rel="prev" title="Using the Qiskit compiler" href="../compiling/compiling.html" /> 
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="docsearch:language" content="None"> 
<link
  rel="alternate"
  type="application/atom+xml"
  href="../../explore/atom.xml"
  title="Quantum Explorations"
/>
 
<style type="text/css">
  ul.ablog-archive {
    list-style: none;
    overflow: auto;
    margin-left: 0px;
  }
  ul.ablog-archive li {
    float: left;
    margin-right: 5px;
    font-size: 80%;
  }
  ul.postlist a {
    font-style: italic;
  }
  ul.postlist-style-disc {
    list-style-type: disc;
  }
  ul.postlist-style-none {
    list-style-type: none;
  }
  ul.postlist-style-circle {
    list-style-type: circle;
  }
</style>

  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">
    <div class="bd-header-announcement container-fluid" id="banner">
      

    </div>

    
    <nav class="bd-header navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="bd-header__inner container-xl">

  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
    <img src="../../_static/logo.png" class="logo__image only-light" alt="Logo image">
    <img src="../../_static/dark_logo.png" class="logo__image only-dark" alt="Logo image">
  
  
</a>
    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="fas fa-bars"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../howto.html">
  How to guides
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../explore.html">
  Explorations
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../hardware/hardware.html">
  IBM Quantum Hardware
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../members.html">
  Members
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the site..." aria-label="Search the site..." autocomplete="off" >
</form>
      </div>
      
      <div class="navbar-end-item">
        <span id="theme-switch" class="btn btn-sm btn-outline-primary navbar-btn rounded-circle">
    <a class="theme-switch" data-mode="light"><i class="fas fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="far fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fas fa-adjust"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/IBM-Quantum-Technical-Enablement" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="bd-container container-xl">
      <div class="bd-container__inner row">
          

<!-- Only show if we have sidebars configured, else just a small margin  -->
<div class="bd-sidebar-primary col-12 col-md-3 bd-sidebar">
  <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the site..." aria-label="Search the site..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Quick start
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../quick/quick-start.html">
   Quick start guide
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Circuit compilation
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../compiling/compiling.html">
   Using the Qiskit compiler
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Error suppression
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Dynamical Decoupling
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Error mitigation
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../mitigation/M3/m3_mitigation.html">
   Mesurement error mitigation using M3
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Visualization
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../visualization/matplotlib.html">
   Matplotlib styles
  </a>
 </li>
</ul>

  </div>
</nav>
  </div>
  <div class="sidebar-end-items">
  </div>
</div>


          


<div class="bd-sidebar-secondary d-none d-xl-block col-xl-2 bd-toc">
  
    
    <div class="toc-item">
      
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#summary">
   Summary
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#frontmatter">
   Frontmatter
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-circuit">
   Example circuit
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#applying-dynamical-decoupling">
     Applying Dynamical Decoupling
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#varying-gate-spacing">
     Varying gate spacing
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#decoupling-a-mid-circuit-measurement">
   Decoupling a mid-circuit measurement
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#application-to-bernstein-vazirani">
   Application to Bernstein-Vazirani
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#setting-up-the-circuit">
     Setting up the circuit
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#verifying-the-functionality-in-simulation">
     Verifying the functionality in simulation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-the-original-circuit">
     Run the original circuit
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#apply-dynamical-decoupling">
     Apply Dynamical Decoupling
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#apply-dynamical-decoupling-more-easily-and-have-a-greater-varity-of-sequences">
   Apply Dynamical Decoupling more easily and have a greater varity of sequences
  </a>
 </li>
</ul>

</nav>
    </div>
    
    <div class="toc-item">
      
    </div>
    
  
</div>


          
          
          <div class="bd-content col-12 col-md-9 col-xl-7">
              
              <article class="bd-article" role="main">
                 <section class="tex2jax_ignore mathjax_ignore" id="dynamical-decoupling">
<h1>Dynamical Decoupling<a class="headerlink" href="#dynamical-decoupling" title="Permalink to this headline">#</a></h1>
<p>
<font size=4 color="#0f62fe">IBM Quantum Enabling Technologies Team</font>
<p><p>Information is futile in the Quantum world. Any operation on qubits, as well as qubits just sitting idle, are subject to noise. <a class="reference external" href="https://en.wikipedia.org/wiki/Quantum_decoherence">Decoherence</a> and <a class="reference external" href="https://en.wikipedia.org/wiki/Dephasing">Dephasing</a> effects are driving qubits towards more classical <a class="reference external" href="https://en.wikipedia.org/wiki/Quantum_state#Mixed_states">Mixed states</a>. A common technique in Quantum Information Processing in order to prevent these effects is <a class="reference external" href="https://en.wikipedia.org/wiki/Dynamical_decoupling">Dynamical Decoupling</a>. We use Dynamical Decoupling in its simplest form, by implementing periodic sequences of gates, which serve to average out unwanted system-enviroment couplings. We focus on decoupling qubits that are idle for some time during a quantum circuit.</p>
<div class="alert alert-warning">
Note that the optimal dynamical decoupling strategy depends largely on the involved specific backend and the circuits & algorithms used. The strategies used here should therefore not be seen as 'cooking recipe' but as experimental work which needs to be adapted to the specific situation of your problem and the real hardware you use.
</div><section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">#</a></h2>
<p>Qiskit offers an in-built <a class="reference external" href="https://qiskit.org/documentation/stubs/qiskit.transpiler.passes.PadDynamicalDecoupling.html"><code class="docutils literal notranslate"><span class="pre">PadDynamicalDecoupling</span></code></a> class which allows to fill gaps in quantum circuits with a dynamical decoupling sequence for noise reduction. In order to use it, a pulse schedule needs to be defined by a <code class="docutils literal notranslate"><span class="pre">PassManager</span></code> applied to your circuit. <code class="docutils literal notranslate"><span class="pre">PadDynamicalDecoupling</span></code> scans the circuit for idle periods of time and inserts a sequence of gates in those spots. These gates amount to the identity, so do they not change the circuit per se and its outcomes, but have the effect of mitigating noise in those idle periods. We will also look at tools from <a class="reference external" href="https://github.com/qiskit-research/qiskit-research">qiskit-research</a> which allow to apply Dynamical Decoupling more easily and have a greater varity of sequences and gates.</p>
</section>
<section id="frontmatter">
<h2>Frontmatter<a class="headerlink" href="#frontmatter" title="Permalink to this headline">#</a></h2>
<p>Here we load the modules needed for the rest of the notebook, our IBM Quantum account and the real backend we’ll use.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">qiskit</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">qiskit.visualization</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1">#Dynamical Decoupling specific modules</span>
<span class="kn">from</span> <span class="nn">qiskit.circuit.library</span> <span class="kn">import</span> <span class="n">XGate</span>
<span class="kn">from</span> <span class="nn">qiskit.transpiler</span> <span class="kn">import</span> <span class="n">PassManager</span><span class="p">,</span> <span class="n">InstructionDurations</span>
<span class="kn">from</span> <span class="nn">qiskit.transpiler.passes</span> <span class="kn">import</span> <span class="n">ALAPScheduleAnalysis</span><span class="p">,</span> <span class="n">PadDynamicalDecoupling</span>
<span class="kn">from</span> <span class="nn">qiskit.quantum_info</span> <span class="kn">import</span> <span class="n">hellinger_fidelity</span>

<span class="c1">#for illustration of backend &amp; qiskit version table</span>
<span class="kn">import</span> <span class="nn">qiskit.tools.jupyter</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;ibmq-dark&#39;</span><span class="p">)</span>
<span class="o">%</span><span class="k">config</span> InlineBackend.figure_format = &#39;retina&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">IBMQ</span><span class="o">.</span><span class="n">load_account</span><span class="p">()</span>
<span class="n">provider</span><span class="o">=</span><span class="n">IBMQ</span><span class="o">.</span><span class="n">get_provider</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="s1">&#39;deployed&#39;</span><span class="p">)</span>
<span class="n">backend</span><span class="o">=</span><span class="n">provider</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">ibm_cairo</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="example-circuit">
<h2>Example circuit<a class="headerlink" href="#example-circuit" title="Permalink to this headline">#</a></h2>
<p>Let us set up an example circuit that we can try to decouple from noise, in this case a GHZ state as a standard example.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">circ</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">circ</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">circ</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">circ</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">circ</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">circ</span><span class="o">.</span><span class="n">measure_all</span><span class="p">()</span>
<span class="c1"># </span>
<span class="n">durations</span> <span class="o">=</span> <span class="n">InstructionDurations</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;h&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> 
        <span class="p">(</span><span class="s2">&quot;cx&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">700</span><span class="p">),</span> 
        <span class="p">(</span><span class="s2">&quot;cx&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="mi">200</span><span class="p">),</span> 
        <span class="p">(</span><span class="s2">&quot;cx&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">300</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;measure&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">50</span><span class="p">)]</span>
<span class="p">)</span>
<span class="n">circ</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/e21d7be4c9455c4cc84bd12fad7d10ff02fe41ba1a6e4f913828384f0724b61e.png" src="../../_images/e21d7be4c9455c4cc84bd12fad7d10ff02fe41ba1a6e4f913828384f0724b61e.png" />
</div>
</div>
<p>In order to run the circuit on a real backend, we transpile it first. We then compare it against a simulator. Also in order to better see the effects of dynamical decoupling here, we chose a rather “noisy” subgraph of the backend in question</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qiskit.visualization</span> <span class="kn">import</span> <span class="n">plot_error_map</span>
<span class="n">plot_error_map</span><span class="p">(</span><span class="n">backend</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/9a0158c37ad53bcd4f47dfd8a051affdac1701f59be89287af5fa0f39bd539e8.png" src="../../_images/9a0158c37ad53bcd4f47dfd8a051affdac1701f59be89287af5fa0f39bd539e8.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">circuit_transpiled</span><span class="o">=</span><span class="n">transpile</span><span class="p">(</span><span class="n">circ</span><span class="p">,</span><span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">,</span><span class="n">initial_layout</span><span class="o">=</span><span class="p">[[</span><span class="mi">23</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">22</span><span class="p">]])</span>
<span class="n">circuit_transpiled</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">idle_wires</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/93353fc2853b4d27a62838283a3c661fc9c0f21083650d88235b95bbf0f77aa0.png" src="../../_images/93353fc2853b4d27a62838283a3c661fc9c0f21083650d88235b95bbf0f77aa0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">job</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">circuit_transpiled</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sim_job</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">ibmq_qasm_simulator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">circ</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="applying-dynamical-decoupling">
<h3>Applying Dynamical Decoupling<a class="headerlink" href="#applying-dynamical-decoupling" title="Permalink to this headline">#</a></h3>
<p>We use <code class="docutils literal notranslate"><span class="pre">PadDynamicalDecoupling</span></code> inside a <code class="docutils literal notranslate"><span class="pre">PassManager</span></code> to add a Decoupling sequence to qubits at idle times. In this case, we use a simple X-X sequence. Note that some backends have different timing constraints, depending on the version of Room Temperature Electronics (control electronics) gateware they run on. This was one of the reasons, <code class="docutils literal notranslate"><span class="pre">PadDynamicalDecoupling</span></code> was recently introduced as a replacement of the previous <code class="docutils literal notranslate"><span class="pre">DynamicalDecoupling</span></code> method, besides improvements in scheduling. There are subtle differences in timing constraints, compare for example the <code class="docutils literal notranslate"><span class="pre">pulse_alignment</span></code> for the following two backends</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">backend</span><span class="o">.</span><span class="n">name</span><span class="p">())</span>
<span class="n">backend</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span><span class="o">.</span><span class="n">timing_constraints</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ibm_cairo
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;acquire_alignment&#39;: 16,
 &#39;granularity&#39;: 16,
 &#39;min_length&#39;: 64,
 &#39;pulse_alignment&#39;: 1}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">provider</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">ibm_washington</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span><span class="o">.</span><span class="n">timing_constraints</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;acquire_alignment&#39;: 16,
 &#39;granularity&#39;: 16,
 &#39;min_length&#39;: 64,
 &#39;pulse_alignment&#39;: 16}
</pre></div>
</div>
</div>
</div>
<p>In order to account for this difference, we include information on pulse alignment to the <code class="docutils literal notranslate"><span class="pre">PadDynamicalDecoupling</span></code> method inside the <code class="docutils literal notranslate"><span class="pre">PassManager</span></code> as we set up to run on the backend.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># balanced X-X sequence on all qubits</span>
<span class="n">dd_sequence</span> <span class="o">=</span> <span class="p">[</span><span class="n">XGate</span><span class="p">(),</span> <span class="n">XGate</span><span class="p">()]</span>

<span class="n">pm</span> <span class="o">=</span> <span class="n">PassManager</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">ALAPScheduleAnalysis</span><span class="p">(</span><span class="n">durations</span><span class="p">),</span>
        <span class="n">PadDynamicalDecoupling</span><span class="p">(</span><span class="n">durations</span><span class="p">,</span> <span class="n">dd_sequence</span><span class="p">,</span> 
        <span class="n">pulse_alignment</span><span class="o">=</span><span class="n">backend</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span><span class="o">.</span><span class="n">timing_constraints</span><span class="p">[</span><span class="s1">&#39;pulse_alignment&#39;</span><span class="p">])</span>
    <span class="p">]</span>
    <span class="p">)</span>
<span class="n">circ_dd</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">circ</span><span class="p">)</span>
<span class="n">circ_dd</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/b369faa3f02f4b00288fc097706f558d9ecfb40f4e8f0d44ada6c4b6fcf2bdf7.png" src="../../_images/b369faa3f02f4b00288fc097706f558d9ecfb40f4e8f0d44ada6c4b6fcf2bdf7.png" />
</div>
</div>
<p>Times are given in units of the smallest possible timestep on a given backend <code class="docutils literal notranslate"><span class="pre">dt</span></code>. This Qubit drive channel timestep is limited by the time resolution of the Room Temperature control Electronics and can be obtained in units of secons by this command:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;dt = &quot;</span><span class="p">,</span><span class="n">backend</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span> <span class="s2">&quot;[seconds]&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dt =  2.2222222222222221e-10 [seconds]
</pre></div>
</div>
</div>
</div>
<p>Note that we need to specify a <code class="docutils literal notranslate"><span class="pre">scheduling_method</span></code> now in order to be able to transpile the circuit</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">circ_dd_transpiled</span><span class="o">=</span><span class="n">transpile</span><span class="p">(</span><span class="n">circ_dd</span><span class="p">,</span><span class="n">backend</span><span class="p">,</span> <span class="n">scheduling_method</span><span class="o">=</span><span class="s2">&quot;alap&quot;</span><span class="p">,</span><span class="n">initial_layout</span><span class="o">=</span><span class="p">[[</span><span class="mi">23</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">22</span><span class="p">]])</span>
<span class="n">circ_dd_transpiled</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="s1">&#39;mpl&#39;</span><span class="p">,</span><span class="n">idle_wires</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/79785eee131e6873f6662256d6683d36a4ea8a74a7bc438c2c327ec9f135df83.png" src="../../_images/79785eee131e6873f6662256d6683d36a4ea8a74a7bc438c2c327ec9f135df83.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dd_job</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">circ_dd_transpiled</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="varying-gate-spacing">
<h3>Varying gate spacing<a class="headerlink" href="#varying-gate-spacing" title="Permalink to this headline">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">PadDynamicalDecoupling</span></code> allows to vary the time between the dynamical decoupling gates by specifing the parameter <code class="docutils literal notranslate"><span class="pre">spacing</span></code>. One way of doing so was given by Prof. Uhrig of TU Dortmund in his paper <a class="reference external" href="https://arxiv.org/abs/quant-ph/0609203">Keeping a Quantum Bit Alive by Optimized π-Pulse Sequences</a>. We can apply his method in the following way</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Uhrig sequence on qubit 0</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">dd_sequence</span> <span class="o">=</span> <span class="p">[</span><span class="n">XGate</span><span class="p">()]</span> <span class="o">*</span> <span class="n">n</span>
<span class="k">def</span> <span class="nf">uhrig_pulse_location</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">2</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span>
<span class="n">spacing</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">spacing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">uhrig_pulse_location</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">spacing</span><span class="p">))</span>
<span class="n">spacing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">spacing</span><span class="p">))</span>

<span class="n">pm</span> <span class="o">=</span> <span class="n">PassManager</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">ALAPScheduleAnalysis</span><span class="p">(</span><span class="n">durations</span><span class="p">),</span>
        <span class="n">PadDynamicalDecoupling</span><span class="p">(</span><span class="n">durations</span><span class="p">,</span> <span class="n">dd_sequence</span><span class="p">,</span> <span class="n">qubits</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">spacing</span><span class="o">=</span><span class="n">spacing</span><span class="p">,</span>
        <span class="n">pulse_alignment</span><span class="o">=</span><span class="n">backend</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span><span class="o">.</span><span class="n">timing_constraints</span><span class="p">[</span><span class="s1">&#39;pulse_alignment&#39;</span><span class="p">]),</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="n">circ_dd_uhrig</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">circ</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">circ_dd_uhrig_transpiled</span><span class="o">=</span><span class="n">transpile</span><span class="p">(</span><span class="n">circ_dd_uhrig</span><span class="p">,</span> <span class="n">backend</span><span class="p">,</span> 
    <span class="n">scheduling_method</span><span class="o">=</span><span class="s2">&quot;alap&quot;</span><span class="p">,</span><span class="n">initial_layout</span><span class="o">=</span><span class="p">[[</span><span class="mi">23</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">22</span><span class="p">]])</span>
<span class="n">circ_dd_uhrig_transpiled</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">idle_wires</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">fold</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/da3fb72221569f67c44d0b27694d40110fd4b33820ccf326153459ed2c48088b.png" src="../../_images/da3fb72221569f67c44d0b27694d40110fd4b33820ccf326153459ed2c48088b.png" />
</div>
</div>
<p>Note the varying times of the Delay instructions and the fact that more gates were included as compared to the previous implementation just above</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dd_job_uhrig</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">circ_dd_uhrig_transpiled</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let us compare the different results by looking at counts and the <a class="reference external" href="https://qiskit.org/documentation/stubs/qiskit.quantum_info.hellinger_fidelity.html">Hellinger Fidelities</a> of the probability distributions as compared to the simulation. The Hellinger fidelity quantifies the similiarity between two probability distributions in terms of their <a class="reference external" href="https://en.wikipedia.org/wiki/Hellinger_distance">Hellinger distance</a> and is 1 in the ideal case of two agreeing probability distributions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">simulated_counts</span><span class="o">=</span><span class="n">sim_job</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()</span>
<span class="n">counts</span><span class="o">=</span><span class="n">job</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()</span>
<span class="n">dd_counts</span> <span class="o">=</span> <span class="n">dd_job</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dd_counts_uhrig</span> <span class="o">=</span> <span class="n">dd_job_uhrig</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()</span>
<span class="n">plot_histogram</span><span class="p">([</span><span class="n">simulated_counts</span><span class="p">,</span><span class="n">counts</span><span class="p">,</span><span class="n">dd_counts</span><span class="p">,</span><span class="n">dd_counts_uhrig</span><span class="p">],</span> 
<span class="n">legend</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;simulated counts&#39;</span><span class="p">,</span><span class="s1">&#39;original counts&#39;</span><span class="p">,</span><span class="s1">&#39;dynamically decoupled counts&#39;</span><span class="p">,</span><span class="s1">&#39;DD using Uhrig spacing&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/39509e6f63391ce5c9a091bb69cf0aab53c7f344488021180d5f5d293877ab95.png" src="../../_images/39509e6f63391ce5c9a091bb69cf0aab53c7f344488021180d5f5d293877ab95.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fidelities</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">hellinger_fidelity</span><span class="p">(</span><span class="n">simulated_counts</span><span class="p">,</span><span class="n">counts</span><span class="p">),</span>
    <span class="n">hellinger_fidelity</span><span class="p">(</span><span class="n">simulated_counts</span><span class="p">,</span><span class="n">dd_counts</span><span class="p">),</span>
    <span class="n">hellinger_fidelity</span><span class="p">(</span><span class="n">simulated_counts</span><span class="p">,</span><span class="n">dd_counts_uhrig</span><span class="p">)</span>
    <span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Hellinger fidelity&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;list index&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;0: original circuit </span><span class="se">\n</span><span class="s1"> 1: dynamically decoupled </span><span class="se">\n</span><span class="s1"> 2: Uhrig spacing&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fidelities</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/99d592c9b247e832fd96e6e6496d6aad8b146f4badd3ccd43225838f83da8859.png" src="../../_images/99d592c9b247e832fd96e6e6496d6aad8b146f4badd3ccd43225838f83da8859.png" />
</div>
</div>
<p>We see that Dynamical Decoupling does have effects on the performance of this basic GHZ circuit, however the dynamical decoupling method needs to be carefully chosen.</p>
</section>
</section>
<section id="decoupling-a-mid-circuit-measurement">
<h2>Decoupling a mid-circuit measurement<a class="headerlink" href="#decoupling-a-mid-circuit-measurement" title="Permalink to this headline">#</a></h2>
<p>Measurements take up quite some time in the course of a circuit. Let us see the effects of applying dynamical decoupling during a measurement &amp; reset sequence. This circuit is inspired by the IBM research blog’s <a class="reference external" href="https://www.ibm.com/blogs/research/2021/02/quantum-mid-circuit-measurement/">introduction</a> of mid-circuit measurements.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">circ_mid_meas</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">circ_mid_meas</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">circ_mid_meas</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">circ_mid_meas</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">circ_mid_meas</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">circ_mid_meas</span><span class="o">.</span><span class="n">barrier</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">circ_mid_meas</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">circ_mid_meas</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">circ_mid_meas</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">circ_mid_meas</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="c1">#durations can also be obtained directly from the specific backend</span>
<span class="n">durations_backend</span> <span class="o">=</span> <span class="n">InstructionDurations</span><span class="o">.</span><span class="n">from_backend</span><span class="p">(</span><span class="n">backend</span><span class="p">)</span>

<span class="n">circ_mid_meas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/37ab956768a123329d59ca2a886783f6505f006d5f8eb892dd27ce6e0cd4ad0f.png" src="../../_images/37ab956768a123329d59ca2a886783f6505f006d5f8eb892dd27ce6e0cd4ad0f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">circ_mid_meas_transp</span><span class="o">=</span><span class="n">transpile</span><span class="p">(</span><span class="n">circ_mid_meas</span><span class="p">,</span><span class="n">backend</span><span class="p">)</span>
<span class="n">circ_mid_meas_transp</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">idle_wires</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/c384d896e3f2a90a436c837987af007ecd8aef508d26e762cd7b974fef880310.png" src="../../_images/c384d896e3f2a90a436c837987af007ecd8aef508d26e762cd7b974fef880310.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">simjob_midmeas</span><span class="o">=</span><span class="n">provider</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">ibmq_qasm_simulator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">circ_mid_meas</span><span class="p">)</span>
<span class="n">job_midmeas_nodd</span><span class="o">=</span><span class="n">backend</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">circ_mid_meas_transp</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">counts_midmeas</span><span class="o">=</span> <span class="n">job_midmeas_nodd</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()</span>
<span class="n">counts_simjob</span><span class="o">=</span> <span class="n">simjob_midmeas</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()</span>
<span class="n">plot_histogram</span><span class="p">([</span><span class="n">counts_simjob</span><span class="p">,</span><span class="n">counts_midmeas</span><span class="p">],</span>
    <span class="n">legend</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mid-circuit meas. simulated&#39;</span><span class="p">,</span><span class="s1">&#39;mid-circuit meas. without DD&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/7182cc4ccdff80ed02882d049f30086595828350fb65ab9603f36ead978bc3a7.png" src="../../_images/7182cc4ccdff80ed02882d049f30086595828350fb65ab9603f36ead978bc3a7.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dd_sequence</span> <span class="o">=</span> <span class="p">[</span><span class="n">XGate</span><span class="p">(),</span> <span class="n">XGate</span><span class="p">()]</span>
<span class="n">pm</span> <span class="o">=</span> <span class="n">PassManager</span><span class="p">([</span><span class="n">ALAPScheduleAnalysis</span><span class="p">(</span><span class="n">durations_backend</span><span class="p">),</span>
                  <span class="n">PadDynamicalDecoupling</span><span class="p">(</span><span class="n">durations_backend</span><span class="p">,</span> <span class="n">dd_sequence</span><span class="p">,</span>
                  <span class="n">pulse_alignment</span><span class="o">=</span><span class="n">backend</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span><span class="o">.</span><span class="n">timing_constraints</span><span class="p">[</span><span class="s1">&#39;pulse_alignment&#39;</span><span class="p">])])</span>
<span class="n">circ_dd_midmeas</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">circ_mid_meas_transp</span><span class="p">)</span>
<span class="n">circ_dd_midmeas</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">idle_wires</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/1c17431730344a3874019203e1171a6e8db32968df3406cf3d2202f96287167d.png" src="../../_images/1c17431730344a3874019203e1171a6e8db32968df3406cf3d2202f96287167d.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">job_dd_midmeas</span><span class="o">=</span><span class="n">backend</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">circ_dd_midmeas</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We also compare with a version of the circuit in which all qubits get dynamically decoupled, even if they are not part of the active circuit at all. We do this by setting <code class="docutils literal notranslate"><span class="pre">skip_reset_qubits=False</span></code> inside <code class="docutils literal notranslate"><span class="pre">PadDynamicalDecoupling</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dd_sequence</span> <span class="o">=</span> <span class="p">[</span><span class="n">XGate</span><span class="p">(),</span> <span class="n">XGate</span><span class="p">()]</span>
<span class="n">pm_skipfalse</span> <span class="o">=</span> <span class="n">PassManager</span><span class="p">([</span><span class="n">ALAPScheduleAnalysis</span><span class="p">(</span><span class="n">durations_backend</span><span class="p">),</span>
                  <span class="n">PadDynamicalDecoupling</span><span class="p">(</span><span class="n">durations_backend</span><span class="p">,</span> <span class="n">dd_sequence</span><span class="p">,</span><span class="n">skip_reset_qubits</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="n">pulse_alignment</span><span class="o">=</span><span class="n">backend</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span><span class="o">.</span><span class="n">timing_constraints</span><span class="p">[</span><span class="s1">&#39;pulse_alignment&#39;</span><span class="p">])])</span>
<span class="n">circ_dd_midmeas_skipfalse</span> <span class="o">=</span> <span class="n">pm_skipfalse</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">circ_mid_meas_transp</span><span class="p">)</span>
<span class="n">circ_dd_midmeas_skipfalse</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">idle_wires</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/b6961254b51b019ba510274b39400f3c455f8ddc234bb23f205d32cecbb652d3.png" src="../../_images/b6961254b51b019ba510274b39400f3c455f8ddc234bb23f205d32cecbb652d3.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">job_dd_midmeas_skipfalse</span><span class="o">=</span><span class="n">backend</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">circ_dd_midmeas_skipfalse</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">simulated_counts_midmeas</span><span class="o">=</span><span class="n">simjob_midmeas</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()</span>
<span class="n">counts_midmeas</span><span class="o">=</span><span class="n">job_midmeas_nodd</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()</span>
<span class="n">counts_dd_midmeas</span><span class="o">=</span><span class="n">job_dd_midmeas</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()</span>
<span class="n">counts_dd_midmeas_skipfalse</span><span class="o">=</span><span class="n">job_dd_midmeas_skipfalse</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()</span>

<span class="n">plot_histogram</span><span class="p">([</span><span class="n">simulated_counts_midmeas</span><span class="p">,</span><span class="n">counts_midmeas</span><span class="p">,</span><span class="n">counts_dd_midmeas</span><span class="p">,</span><span class="n">counts_dd_midmeas_skipfalse</span><span class="p">],</span>
<span class="n">title</span><span class="o">=</span><span class="n">backend</span><span class="o">.</span><span class="n">name</span><span class="p">(),</span> 
<span class="n">legend</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;simulation&#39;</span><span class="p">,</span><span class="s1">&#39;original circuit&#39;</span><span class="p">,</span><span class="s1">&#39;dynamically decoupled&#39;</span><span class="p">,</span><span class="s1">&#39;decoupling on all qubits&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/da03e5d0cc8606fa60674e65fa3a3e82a295c650f87b4d6bc760d72edf97e94e.png" src="../../_images/da03e5d0cc8606fa60674e65fa3a3e82a295c650f87b4d6bc760d72edf97e94e.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">counts_array_midmeas</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">hellinger_fidelity</span><span class="p">(</span><span class="n">simulated_counts_midmeas</span><span class="p">,</span><span class="n">counts_midmeas</span><span class="p">),</span>
    <span class="n">hellinger_fidelity</span><span class="p">(</span><span class="n">simulated_counts_midmeas</span><span class="p">,</span><span class="n">counts_dd_midmeas</span><span class="p">),</span>
    <span class="n">hellinger_fidelity</span><span class="p">(</span><span class="n">simulated_counts_midmeas</span><span class="p">,</span><span class="n">counts_dd_midmeas_skipfalse</span><span class="p">)]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Hellinger fidelity&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;list index&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;0: original circuit </span><span class="se">\n</span><span class="s1"> 1: dynamically decoupled circuit </span><span class="se">\n</span><span class="s1"> 2: decoupling on all qubits&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">counts_array_midmeas</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/eb830fe171430388e571d5c815fa702a7374eb65139cb967f41a3b6782d354b7.png" src="../../_images/eb830fe171430388e571d5c815fa702a7374eb65139cb967f41a3b6782d354b7.png" />
</div>
</div>
<p>We see that Dynamical Decoupling is beneficial in general, however applying extra pulses to passive qubits was not successful in this case. There can be cases in which spectator qubits play an important role, however, which is when decoupling on all qubits can be beneficial.</p>
</section>
<section id="application-to-bernstein-vazirani">
<h2>Application to Bernstein-Vazirani<a class="headerlink" href="#application-to-bernstein-vazirani" title="Permalink to this headline">#</a></h2>
<p>The <a class="reference external" href="https://qiskit.org/textbook/ch-algorithms/bernstein-vazirani.html">Bernstein-Vazirani Algorithm</a> is a modification of the Deutsch-Josza algorithm. It is constructed to learn a string encoded in a function. Its circuits turn out to possess long idle times and have thus <a class="reference external" href="https://gist.github.com/blakejohnson/9d0d7aa8c50350f869ed3eeca185f8f0">shown to be well-suited</a> for an application of the kind of dynamical decoupling presented. Let us look at this effect in a concise manner.</p>
<section id="setting-up-the-circuit">
<h3>Setting up the circuit<a class="headerlink" href="#setting-up-the-circuit" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_oracle</span><span class="p">(</span><span class="n">num_qubits</span><span class="p">,</span> <span class="n">input_size</span><span class="p">,</span> <span class="n">secret_int</span><span class="p">):</span>
    <span class="c1"># Initialize first n qubits and single ancilla qubit</span>
    <span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">num_qubits</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Uf&quot;</span><span class="p">)</span>

    <span class="c1"># perform CX for each qubit that matches a bit in secret string</span>
    <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;{0:0&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">input_size</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;b}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">secret_int</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i_qubit</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">input_size</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="n">input_size</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">i_qubit</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
            <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="n">i_qubit</span><span class="p">,</span> <span class="n">input_size</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">qc</span>


<span class="k">def</span> <span class="nf">bernstein_vazirani</span><span class="p">(</span><span class="n">num_qubits</span><span class="p">,</span> <span class="n">secret_int</span><span class="p">):</span>
    
    <span class="c1"># size of input is one less than available qubits</span>
    <span class="n">input_size</span> <span class="o">=</span> <span class="n">num_qubits</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="c1"># setup circuit</span>
    <span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">num_qubits</span><span class="p">,</span> <span class="n">input_size</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;main&quot;</span><span class="p">)</span>

    <span class="c1"># put ancilla in |1&gt; state</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="n">input_size</span><span class="p">)</span>

    <span class="c1"># start with Hadamard on all qubits, including ancilla</span>
    <span class="k">for</span> <span class="n">i_qubit</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_qubits</span><span class="p">):</span>
         <span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">i_qubit</span><span class="p">)</span>

    <span class="n">qc</span><span class="o">.</span><span class="n">barrier</span><span class="p">()</span>

    <span class="c1"># generate Uf oracle</span>
    <span class="n">Uf</span> <span class="o">=</span> <span class="n">create_oracle</span><span class="p">(</span><span class="n">num_qubits</span><span class="p">,</span> <span class="n">input_size</span><span class="p">,</span> <span class="n">secret_int</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Uf</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_qubits</span><span class="p">))</span>

    <span class="n">qc</span><span class="o">.</span><span class="n">barrier</span><span class="p">()</span>

    <span class="c1"># Hadamard again on all non-ancilla qubits,</span>
    <span class="k">for</span> <span class="n">i_qubit</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">input_size</span><span class="p">):</span>
         <span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">i_qubit</span><span class="p">)</span>

    <span class="n">qc</span><span class="o">.</span><span class="n">barrier</span><span class="p">()</span>

    <span class="c1"># measure all data qubits</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">input_size</span><span class="p">):</span>
        <span class="n">qc</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">qc</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bv_circuit_test</span> <span class="o">=</span> <span class="n">bernstein_vazirani</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="s1">&#39;1101&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">bv_circuit_test</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="s1">&#39;mpl&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/90fd313b7ff74f836b9f983b9d8fa943aeba119ffd6685d25b1c959c77841416.png" src="../../_images/90fd313b7ff74f836b9f983b9d8fa943aeba119ffd6685d25b1c959c77841416.png" />
</div>
</div>
</section>
<section id="verifying-the-functionality-in-simulation">
<h3>Verifying the functionality in simulation<a class="headerlink" href="#verifying-the-functionality-in-simulation" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sim_backend</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">ibmq_qasm_simulator</span>
<span class="n">sim_job_bv</span> <span class="o">=</span> <span class="n">sim_backend</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">transpile</span><span class="p">(</span><span class="n">bv_circuit_test</span><span class="p">,</span> <span class="n">sim_backend</span><span class="p">),</span> <span class="n">shots</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">sim_result</span> <span class="o">=</span> <span class="n">sim_job_bv</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
<span class="n">sim_result</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;1101&#39;: 1}
</pre></div>
</div>
</div>
</div>
<p>We get back the binary string we passed to the BV function as desired. Now let’s…</p>
</section>
<section id="run-the-original-circuit">
<h3>Run the original circuit<a class="headerlink" href="#run-the-original-circuit" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bv_circuit</span> <span class="o">=</span> <span class="n">bernstein_vazirani</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="s1">&#39;1111&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">bv_transpiled</span> <span class="o">=</span> <span class="n">transpile</span><span class="p">(</span><span class="n">bv_circuit</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">)</span>
<span class="n">bv_transpiled</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="s1">&#39;mpl&#39;</span><span class="p">,</span><span class="n">fold</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="c1">#,idle_wires=False)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/2d3234c966d195466800f4dc4997ba1cf83b51ada6dac9493c77479bc15c5c4a.png" src="../../_images/2d3234c966d195466800f4dc4997ba1cf83b51ada6dac9493c77479bc15c5c4a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">job_bv_original</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">bv_transpiled</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">counts_bv_original</span><span class="o">=</span> <span class="n">job_bv_original</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()</span>
<span class="c1">#print(&#39;no. shots used&#39;,job_bv_original.result().results[0].shots)</span>
<span class="n">plot_histogram</span><span class="p">(</span><span class="n">counts_bv_original</span><span class="p">,</span>
<span class="n">title</span><span class="o">=</span><span class="s1">&#39;original circuit. </span><span class="se">\n</span><span class="s1"> success probability: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span>
    <span class="n">counts_bv_original</span><span class="p">[</span><span class="s1">&#39;1111&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">4000</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/17df50fcdbf0d480e9efb91b66e7eb50ad0022c86dc9a9b890e96f3fb2348190.png" src="../../_images/17df50fcdbf0d480e9efb91b66e7eb50ad0022c86dc9a9b890e96f3fb2348190.png" />
</div>
</div>
<p>The success probability is not too high. Can’t we do better than this?</p>
</section>
<section id="apply-dynamical-decoupling">
<h3>Apply Dynamical Decoupling<a class="headerlink" href="#apply-dynamical-decoupling" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">durations_backend</span> <span class="o">=</span> <span class="n">InstructionDurations</span><span class="o">.</span><span class="n">from_backend</span><span class="p">(</span><span class="n">backend</span><span class="p">)</span>
<span class="n">dd_sequence</span> <span class="o">=</span> <span class="p">[</span><span class="n">XGate</span><span class="p">(),</span> <span class="n">XGate</span><span class="p">()]</span>
<span class="n">pm</span> <span class="o">=</span> <span class="n">PassManager</span><span class="p">([</span><span class="n">ALAPScheduleAnalysis</span><span class="p">(</span><span class="n">durations_backend</span><span class="p">),</span>
                  <span class="n">PadDynamicalDecoupling</span><span class="p">(</span><span class="n">durations_backend</span><span class="p">,</span> <span class="n">dd_sequence</span><span class="p">,</span>
                  <span class="n">pulse_alignment</span><span class="o">=</span><span class="n">backend</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span><span class="o">.</span><span class="n">timing_constraints</span><span class="p">[</span><span class="s1">&#39;pulse_alignment&#39;</span><span class="p">])])</span>

<span class="c1"># transpile and view the resulting circuit</span>
<span class="n">circ_dd_bv</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">bv_transpiled</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">circ_dd_bv</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="s1">&#39;mpl&#39;</span><span class="p">,</span><span class="n">idle_wires</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">fold</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/f66d3de08fec1e13b2d31aa162d43941b31d2f44d9c9f781bbe6502aeffa724f.png" src="../../_images/f66d3de08fec1e13b2d31aa162d43941b31d2f44d9c9f781bbe6502aeffa724f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">job_bv_decoupled</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">circ_dd_bv</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">counts_bv_decoupled</span><span class="o">=</span> <span class="n">job_bv_decoupled</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()</span>
<span class="c1">#print(&#39;no. shots used&#39;,job_bv_original.result().results[0].shots)</span>
<span class="n">plot_histogram</span><span class="p">(</span><span class="n">counts_bv_decoupled</span><span class="p">,</span>
<span class="n">title</span><span class="o">=</span><span class="s1">&#39;dynamically decoupled circuit. </span><span class="se">\n</span><span class="s1"> success probability: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span>
    <span class="n">counts_bv_decoupled</span><span class="p">[</span><span class="s1">&#39;1111&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">4000</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/0b649b8556ef3175ea9d0abff8f95b18d0dbfa3319b5c42b248ee87eccd8e677.png" src="../../_images/0b649b8556ef3175ea9d0abff8f95b18d0dbfa3319b5c42b248ee87eccd8e677.png" />
</div>
</div>
<p>Note that the success probability is notably increased by running the BV algorithm with dynamical decoupling.</p>
<p>Summa: Do use dynamical decoupling, especially if your circuits contain lots of idle time for some qubits!</p>
</section>
</section>
<section id="apply-dynamical-decoupling-more-easily-and-have-a-greater-varity-of-sequences">
<h2>Apply Dynamical Decoupling more easily and have a greater varity of sequences<a class="headerlink" href="#apply-dynamical-decoupling-more-easily-and-have-a-greater-varity-of-sequences" title="Permalink to this headline">#</a></h2>
<p>We saw that managing <code class="docutils literal notranslate"><span class="pre">PassManager</span></code>, scheduling and chosing the right methods for transpiling are somewhat involved. Luckily there are people working on making life easier for you as a user at <a class="reference external" href="https://github.com/qiskit-research/qiskit-research">qiskit-research</a> . A useful utility in this context is the method <code class="docutils literal notranslate"><span class="pre">add_dynamical_decoupling</span></code></p>
<p>Install qiskit-research by running</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">qiskit</span><span class="o">-</span><span class="n">research</span><span class="o">/</span><span class="n">qiskit</span><span class="o">-</span><span class="n">research</span><span class="o">.</span><span class="n">git</span>
<span class="n">cd</span> <span class="n">qiskit</span><span class="o">-</span><span class="n">research</span>
<span class="n">pip</span> <span class="n">install</span> <span class="o">.</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">circuit_transpiled</span><span class="o">=</span><span class="n">transpile</span><span class="p">(</span><span class="n">circ</span><span class="p">,</span><span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">,</span><span class="n">initial_layout</span><span class="o">=</span><span class="p">[[</span><span class="mi">23</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">22</span><span class="p">]])</span>
<span class="n">circuit_transpiled</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">idle_wires</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/93353fc2853b4d27a62838283a3c661fc9c0f21083650d88235b95bbf0f77aa0.png" src="../../_images/93353fc2853b4d27a62838283a3c661fc9c0f21083650d88235b95bbf0f77aa0.png" />
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">add_dynamical_decoupling</span></code> makes it easy to add sepcific DD sequences to a circuit that is transpiled to match the gate definitions of the backend. It also gives you the option to specify a string of which sequence you would like to add. At the time of writing, the following sequences are available:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dd_sequences</span><span class="o">=</span> <span class="p">[</span><span class="s2">&quot;X2&quot;</span><span class="p">,</span><span class="s2">&quot;XY4&quot;</span><span class="p">,</span><span class="s2">&quot;XY8&quot;</span><span class="p">,</span><span class="s2">&quot;X2pm&quot;</span><span class="p">,</span><span class="s2">&quot;XY4pm&quot;</span><span class="p">,</span><span class="s2">&quot;XY8pm&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Note that the suffix <code class="docutils literal notranslate"><span class="pre">&quot;pm&quot;</span></code> indicates plus, minus and refers to rotations with positive or negative sign, respectively. At the microwave pulse level, this corresponds to the sign of the amplitude. The circuit below shows an example of a <code class="docutils literal notranslate"><span class="pre">&quot;X2pm&quot;</span></code> decoupling sequence.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qiskit_research.utils.convenience</span> <span class="kn">import</span> <span class="n">add_dynamical_decoupling</span>

<span class="n">circ_with_dd</span> <span class="o">=</span> <span class="n">add_dynamical_decoupling</span><span class="p">(</span><span class="n">circuit_transpiled</span><span class="p">,</span> <span class="n">backend</span><span class="p">,</span> <span class="s2">&quot;X2pm&quot;</span><span class="p">,</span> <span class="n">add_pulse_cals</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">circ_with_dd</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/fa4871fc4284bce10392337d198ea4f97080a27ec015dc79081614af4618d4f0.png" src="../../_images/fa4871fc4284bce10392337d198ea4f97080a27ec015dc79081614af4618d4f0.png" />
</div>
</div>
<p>So let us compare the effects of different sequences added to the original GHZ circuit. Note that we need to input a transpiled circuit to the <code class="docutils literal notranslate"><span class="pre">add_dynamical_decoupling</span></code> method, such that the right basis gates and instruction durations are provided. Here, we also transpile again after adding dynamical decoupling since some of the gates involved are not part of the basis gate set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">backend</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span><span class="o">.</span><span class="n">basis_gates</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;id&#39;, &#39;rz&#39;, &#39;sx&#39;, &#39;x&#39;, &#39;cx&#39;, &#39;reset&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dd_circuits</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">sequence</span> <span class="ow">in</span> <span class="n">dd_sequences</span><span class="p">:</span>
    <span class="n">dd_circuits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">transpile</span><span class="p">(</span>
        <span class="n">add_dynamical_decoupling</span><span class="p">(</span><span class="n">circuit_transpiled</span><span class="p">,</span> <span class="n">backend</span><span class="p">,</span> <span class="n">sequence</span><span class="p">,</span> <span class="n">add_pulse_cals</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="p">,</span><span class="n">backend</span><span class="p">,</span><span class="n">scheduling_method</span><span class="o">=</span><span class="s2">&quot;alap&quot;</span><span class="p">)</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">job_dd_circs</span><span class="o">=</span><span class="n">backend</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">dd_circuits</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">simulated_counts</span><span class="o">=</span><span class="n">sim_job</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()</span>

<span class="n">hellinger_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">hellinger_fidelity</span><span class="p">(</span><span class="n">simulated_counts</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>

<span class="n">fidelities2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">hellinger_function</span><span class="p">,</span>
    <span class="n">job_dd_circs</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()))</span>

<span class="n">fidelities_dict</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">dd_sequences</span><span class="p">,</span><span class="n">fidelities2</span><span class="p">))</span>
<span class="n">plot_histogram</span><span class="p">(</span><span class="n">fidelities_dict</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">dd_sequences</span><span class="p">,</span><span class="n">fidelities2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Hellinger fidelities of Dynamical Decoupling sequences&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">fidelities2</span><span class="p">)</span><span class="o">*</span><span class="mf">0.999</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">fidelities2</span><span class="p">)</span><span class="o">*</span><span class="mf">1.001</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/bb376a453929585e28946f7fa71d1494f7ae60e99501e39f9948a1dab457b8f2.png" src="../../_images/bb376a453929585e28946f7fa71d1494f7ae60e99501e39f9948a1dab457b8f2.png" />
</div>
</div>
<p>So we already see that there may be better sequences than X-X, depending on the circuit in question. However, why do the <code class="docutils literal notranslate"><span class="pre">&quot;pm&quot;</span></code> sequences perform so poorly in terms of Hellinger fidelity? Let us see what the second transpilation did to the circuit with the <code class="docutils literal notranslate"><span class="pre">&quot;X2pm&quot;</span></code> sequence applied.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">transpile</span><span class="p">(</span><span class="n">circ_with_dd</span><span class="p">,</span><span class="n">backend</span><span class="p">,</span><span class="n">scheduling_method</span><span class="o">=</span><span class="s2">&quot;alap&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/0f15f91505b80fad25748b7277dd5155e166d87243cf0573d8eca4bdebc602b4.png" src="../../_images/0f15f91505b80fad25748b7277dd5155e166d87243cf0573d8eca4bdebc602b4.png" />
</div>
</div>
<p>So the <code class="docutils literal notranslate"><span class="pre">&quot;Xp&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;Xm&quot;</span></code> gates were transpiled back to basis gates again. Instead, if we want to use those gates as intended, we have to specify the option <code class="docutils literal notranslate"><span class="pre">add_pulse_cals=True</span></code> within <code class="docutils literal notranslate"><span class="pre">add_dynamical_decoupling</span></code>. The method will take care of defining those gates for us at the Pulse level.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dd_circuits_cals</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">sequence</span> <span class="ow">in</span> <span class="n">dd_sequences</span><span class="p">:</span>
    <span class="n">dd_circuits_cals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">add_dynamical_decoupling</span><span class="p">(</span><span class="n">circuit_transpiled</span><span class="p">,</span> <span class="n">backend</span><span class="p">,</span> <span class="n">sequence</span><span class="p">,</span> <span class="n">add_pulse_cals</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">job_dd_cals</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">dd_circuits_cals</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>As an example, the circuit now looks like this with the <code class="docutils literal notranslate"><span class="pre">&quot;XY4pm&quot;</span></code> sequence added</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dd_circuits_cals</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">fold</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/74c8e01c47b0259f3ecd55fa92d40e26401fa9b56676952c5e8f1bef7067dd27.png" src="../../_images/74c8e01c47b0259f3ecd55fa92d40e26401fa9b56676952c5e8f1bef7067dd27.png" />
</div>
</div>
<p>These tricks can increase the performance of our circuit run on the backend by quite a bit. Note how the sequences containing custom gates <code class="docutils literal notranslate"><span class="pre">&quot;XY*&quot;</span></code> as well as the <code class="docutils literal notranslate"><span class="pre">&quot;*pm&quot;</span></code> sequences improve in performance relative to <code class="docutils literal notranslate"><span class="pre">&quot;X2&quot;</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">simulated_counts</span><span class="o">=</span><span class="n">sim_job</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()</span>

<span class="n">hellinger_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">hellinger_fidelity</span><span class="p">(</span><span class="n">simulated_counts</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>

<span class="n">fidelities3</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">hellinger_function</span><span class="p">,</span>
    <span class="n">job_dd_cals</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()))</span>

<span class="n">fidelities_dict3</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">dd_sequences</span><span class="p">,</span><span class="n">fidelities3</span><span class="p">))</span>
<span class="n">plot_histogram</span><span class="p">(</span><span class="n">fidelities_dict3</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">dd_sequences</span><span class="p">,</span><span class="n">fidelities3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Hellinger fidelities of Dynamical Decoupling sequences&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">fidelities3</span><span class="p">)</span><span class="o">*</span><span class="mf">0.999</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">fidelities3</span><span class="p">)</span><span class="o">*</span><span class="mf">1.001</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/96b53fd6823943f0d550d3e6a3457fd8d2a43056d2a6113956afd2f8e7f1e81a.png" src="../../_images/96b53fd6823943f0d550d3e6a3457fd8d2a43056d2a6113956afd2f8e7f1e81a.png" />
</div>
</div>
<p>Let’s confirm this observation statistically by running the same experiment with 100 circuits and 100.000 shots for each dynamical decoupling sequence applied to our exemplary GHZ circuit and compare against a circuit with no dynamical decoupling applied.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sequences</span><span class="o">=</span><span class="n">dd_sequences</span><span class="o">+</span><span class="n">dd_sequences</span><span class="o">+</span><span class="p">[</span><span class="s1">&#39;no_dd&#39;</span><span class="p">]</span>
<span class="c1">#initializing a dictonary for jobs for all sequences + the circuit with no dynamical decoupling applied</span>
<span class="n">job_dict</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">sequences</span><span class="p">,</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sequences</span><span class="p">))))</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s run all these jobs on the backend (this will take a while)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dd_circuits_statistics</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">sequence</span> <span class="ow">in</span> <span class="n">dd_sequences</span><span class="p">:</span>
    <span class="n">circ_sequence</span><span class="o">=</span><span class="n">add_dynamical_decoupling</span><span class="p">(</span><span class="n">circuit_transpiled</span><span class="p">,</span> <span class="n">backend</span><span class="p">,</span> <span class="n">sequence</span><span class="p">,</span> <span class="n">add_pulse_cals</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">job_dict</span><span class="p">[</span><span class="n">sequence</span><span class="p">]</span><span class="o">=</span><span class="n">backend</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="n">circ_sequence</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="n">backend</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span><span class="o">.</span><span class="n">max_shots</span><span class="p">)</span>
    <span class="n">job_dict</span><span class="p">[</span><span class="n">sequence</span><span class="p">]</span><span class="o">.</span><span class="n">update_tags</span><span class="p">(</span><span class="n">additional_tags</span><span class="o">=</span><span class="p">[</span><span class="n">sequence</span><span class="p">,</span><span class="s2">&quot;dynamical decoupling&quot;</span><span class="p">])</span>

<span class="n">job_dict</span><span class="p">[</span><span class="s1">&#39;no_dd&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">backend</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="n">circuit_transpiled</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="n">backend</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span><span class="o">.</span><span class="n">max_shots</span><span class="p">)</span>
<span class="n">job_dict</span><span class="p">[</span><span class="s1">&#39;no_dd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update_tags</span><span class="p">(</span><span class="n">additional_tags</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;no_dd&#39;</span><span class="p">]);</span>
</pre></div>
</div>
</div>
</div>
<p>After the 70.000.000 shots finished running, we collect Hellinger fidelities for each of the circuits</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fidelities_all</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">sequences</span><span class="p">,</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sequences</span><span class="p">))))</span>
<span class="k">for</span> <span class="n">sequence</span> <span class="ow">in</span> <span class="n">job_dict</span><span class="p">:</span>
    <span class="n">fidelities_all</span><span class="p">[</span><span class="n">sequence</span><span class="p">]</span><span class="o">=</span>
    <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">hellinger_function</span><span class="p">,</span>
    <span class="n">job_dict</span><span class="p">[</span><span class="n">sequence</span><span class="p">]</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="k">for</span> <span class="n">sequence</span> <span class="ow">in</span> <span class="n">fidelities_all</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">sequence</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="n">fidelities_all</span><span class="p">[</span><span class="n">sequence</span><span class="p">],</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Hellinger fidelities of dd sequences, 100 circuits at 100.000 shots each&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">fidelities_all</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span><span class="o">*</span><span class="mf">0.999</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">fidelities_all</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span><span class="o">*</span><span class="mf">1.001</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/cfafe9fe8e891958d419f9ffd6c783d686e07953cb6a6c2e59a83c143be19be7.png" src="../../_images/cfafe9fe8e891958d419f9ffd6c783d686e07953cb6a6c2e59a83c143be19be7.png" />
</div>
</div>
<p>This confirms that X2pm is the best sequence in this case. Note that the circuit without dynamical decoupling applied, at the right side of the plot above, performs comparably. As mentioned at the beginning of this guide, if and how to apply dynamical decoupling has to be analyzed on a case-by-case basis depending on the circuit and backend in question.</p>
<p>In Summary, we are provided with tools to easily add dynamical decoupling to our circuit and increase its Fidelity with gates defined at the Qiskit Pulse level.</p>
<p>We see that using custom gates defined at Qiskit Pulse level is beneficial as compared to transpilation to the basis gates. This observation is confirmed in the literature, c.f. the recent arxiv <a class="reference external" href="https://arxiv.org/abs/2207.03670">Dynamical decoupling for superconducting qubits: a performance survey</a>, in particular Appendix B. There is ongoing work of extending the sequences available for dynamical decoupling at the pulse level, including the higher-order sequences discussed in the referenced paper.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">qiskit_version_table</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><h3>Version Information</h3><table><tr><th>Qiskit Software</th><th>Version</th></tr><tr><td><code>qiskit-terra</code></td><td>0.21.0</td></tr><tr><td><code>qiskit-aer</code></td><td>0.10.4</td></tr><tr><td><code>qiskit-ignis</code></td><td>0.7.1</td></tr><tr><td><code>qiskit-ibmq-provider</code></td><td>0.19.2</td></tr><tr><td><code>qiskit</code></td><td>0.37.0</td></tr><tr><td><code>qiskit-nature</code></td><td>0.4.2</td></tr><tr><td><code>qiskit-finance</code></td><td>0.3.3</td></tr><tr><td><code>qiskit-optimization</code></td><td>0.4.0</td></tr><tr><td><code>qiskit-machine-learning</code></td><td>0.4.0</td></tr><tr><th>System information</th></tr><tr><td>Python version</td><td>3.8.2</td></tr><tr><td>Python compiler</td><td>MSC v.1916 64 bit (AMD64)</td></tr><tr><td>Python build</td><td>default, Apr 14 2020 19:01:40</td></tr><tr><td>OS</td><td>Windows</td></tr><tr><td>CPUs</td><td>4</td></tr><tr><td>Memory (Gb)</td><td>7.838371276855469</td></tr><tr><td colspan='2'>Mon Jul 25 10:00:05 2022 W. Europe Summer Time</td></tr></table></div></div>
</div>
</section>
</section>

<div class="section">
   
</div>

              </article>
              

              
              <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="../compiling/compiling.html" title="previous page">
      <i class="fas fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title">Using the Qiskit compiler</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="../mitigation/M3/m3_mitigation.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title">Mesurement error mitigation using M3</p>
  </div>
  <i class="fas fa-angle-right"></i>
  </a>
</div>
              </footer>
              
          </div>
          
      </div>
    </div>

  
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695"></script>

<footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    <p class="copyright">
    &copy; Copyright 2022, IBM Quantum.<br>
</p>
  </div>
  
  <div class="footer-item">
    <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.4.0.<br>
</p>
  </div>
  
</div>
</footer>
  </body>
</html>